"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const setup = require("./hotswap-test-setup");
const common_1 = require("../../../lib/api/hotswap/common");
const s3_bucket_deployments_1 = require("../../../lib/api/hotswap/s3-bucket-deployments");
let mockLambdaInvoke;
let hotswapMockSdkProvider;
const payloadWithoutCustomResProps = {
    RequestType: 'Update',
    ResponseURL: s3_bucket_deployments_1.REQUIRED_BY_CFN,
    PhysicalResourceId: s3_bucket_deployments_1.REQUIRED_BY_CFN,
    StackId: s3_bucket_deployments_1.REQUIRED_BY_CFN,
    RequestId: s3_bucket_deployments_1.REQUIRED_BY_CFN,
    LogicalResourceId: s3_bucket_deployments_1.REQUIRED_BY_CFN,
};
beforeEach(() => {
    hotswapMockSdkProvider = setup.setupHotswapTests();
    mockLambdaInvoke = jest.fn();
    hotswapMockSdkProvider.setInvokeLambdaMock(mockLambdaInvoke);
});
describe.each([common_1.HotswapMode.FALL_BACK, common_1.HotswapMode.HOTSWAP_ONLY])('%p mode', (hotswapMode) => {
    test('calls the lambdaInvoke() API when it receives only an asset difference in an S3 bucket deployment and evaluates CFN expressions in S3 Deployment Properties', async () => {
        // GIVEN
        setup.setCurrentCfnStackTemplate({
            Resources: {
                S3Deployment: {
                    Type: 'Custom::CDKBucketDeployment',
                    Properties: {
                        ServiceToken: 'a-lambda-arn',
                        SourceBucketNames: ['src-bucket'],
                        SourceObjectKeys: ['src-key-old'],
                        DestinationBucketName: 'dest-bucket',
                        DestinationBucketKeyPrefix: 'my-key/some-old-prefix',
                    },
                },
            },
        });
        const cdkStackArtifact = setup.cdkStackArtifactOf({
            template: {
                Resources: {
                    S3Deployment: {
                        Type: 'Custom::CDKBucketDeployment',
                        Properties: {
                            ServiceToken: 'a-lambda-arn',
                            SourceBucketNames: ['src-bucket'],
                            SourceObjectKeys: {
                                'Fn::Split': [
                                    '-',
                                    'key1-key2-key3',
                                ],
                            },
                            DestinationBucketName: 'dest-bucket',
                            DestinationBucketKeyPrefix: 'my-key/some-new-prefix',
                        },
                    },
                },
            },
        });
        // WHEN
        const deployStackResult = await hotswapMockSdkProvider.tryHotswapDeployment(hotswapMode, cdkStackArtifact);
        // THEN
        expect(deployStackResult).not.toBeUndefined();
        expect(mockLambdaInvoke).toHaveBeenCalledWith({
            FunctionName: 'a-lambda-arn',
            Payload: JSON.stringify({
                ...payloadWithoutCustomResProps,
                ResourceProperties: {
                    SourceBucketNames: ['src-bucket'],
                    SourceObjectKeys: ['key1', 'key2', 'key3'],
                    DestinationBucketName: 'dest-bucket',
                    DestinationBucketKeyPrefix: 'my-key/some-new-prefix',
                },
            }),
        });
    });
    test('does not call the invoke() API when a resource with type that is not Custom::CDKBucketDeployment but has the same properties is changed', async () => {
        // GIVEN
        setup.setCurrentCfnStackTemplate({
            Resources: {
                S3Deployment: {
                    Type: 'Custom::NotCDKBucketDeployment',
                    Properties: {
                        SourceObjectKeys: ['src-key-old'],
                    },
                },
            },
        });
        const cdkStackArtifact = setup.cdkStackArtifactOf({
            template: {
                Resources: {
                    S3Deployment: {
                        Type: 'Custom::NotCDKBucketDeployment',
                        Properties: {
                            SourceObjectKeys: ['src-key-new'],
                        },
                    },
                },
            },
        });
        if (hotswapMode === common_1.HotswapMode.FALL_BACK) {
            // WHEN
            const deployStackResult = await hotswapMockSdkProvider.tryHotswapDeployment(hotswapMode, cdkStackArtifact);
            // THEN
            expect(deployStackResult).toBeUndefined();
            expect(mockLambdaInvoke).not.toHaveBeenCalled();
        }
        else if (hotswapMode === common_1.HotswapMode.HOTSWAP_ONLY) {
            // WHEN
            const deployStackResult = await hotswapMockSdkProvider.tryHotswapDeployment(hotswapMode, cdkStackArtifact);
            // THEN
            expect(deployStackResult).not.toBeUndefined();
            expect(deployStackResult?.noOp).toEqual(true);
            expect(mockLambdaInvoke).not.toHaveBeenCalled();
        }
    });
    test('does not call the invokeLambda() api if the updated Policy has no Roles in CLASSIC mode but does in HOTSWAP_ONLY mode', async () => {
        // GIVEN
        setup.setCurrentCfnStackTemplate({
            Parameters: {
                WebsiteBucketParamOld: { Type: 'String' },
                WebsiteBucketParamNew: { Type: 'String' },
            },
            Resources: {
                S3Deployment: {
                    Type: 'Custom::CDKBucketDeployment',
                    Properties: {
                        ServiceToken: 'a-lambda-arn',
                        SourceObjectKeys: ['src-key-old'],
                        SourceBucketNames: ['src-bucket'],
                        DestinationBucketName: 'dest-bucket',
                    },
                },
                Policy: {
                    Type: 'AWS::IAM::Policy',
                    Properties: {
                        PolicyName: 'my-policy',
                        PolicyDocument: {
                            Statement: [
                                {
                                    Action: ['s3:GetObject*'],
                                    Effect: 'Allow',
                                    Resource: {
                                        Ref: 'WebsiteBucketParamOld',
                                    },
                                },
                            ],
                        },
                    },
                },
            },
        });
        const cdkStackArtifact = setup.cdkStackArtifactOf({
            template: {
                Parameters: {
                    WebsiteBucketParamOld: { Type: 'String' },
                    WebsiteBucketParamNew: { Type: 'String' },
                },
                Resources: {
                    S3Deployment: {
                        Type: 'Custom::CDKBucketDeployment',
                        Properties: {
                            ServiceToken: 'a-lambda-arn',
                            SourceObjectKeys: ['src-key-new'],
                            SourceBucketNames: ['src-bucket'],
                            DestinationBucketName: 'dest-bucket',
                        },
                    },
                    Policy: {
                        Type: 'AWS::IAM::Policy',
                        Properties: {
                            PolicyName: 'my-policy',
                            PolicyDocument: {
                                Statement: [
                                    {
                                        Action: ['s3:GetObject*'],
                                        Effect: 'Allow',
                                        Resource: {
                                            Ref: 'WebsiteBucketParamNew',
                                        },
                                    },
                                ],
                            },
                        },
                    },
                },
            },
        });
        if (hotswapMode === common_1.HotswapMode.FALL_BACK) {
            // WHEN
            const deployStackResult = await hotswapMockSdkProvider.tryHotswapDeployment(hotswapMode, cdkStackArtifact);
            // THEN
            expect(deployStackResult).toBeUndefined();
            expect(mockLambdaInvoke).not.toHaveBeenCalled();
        }
        else if (hotswapMode === common_1.HotswapMode.HOTSWAP_ONLY) {
            // WHEN
            const deployStackResult = await hotswapMockSdkProvider.tryHotswapDeployment(hotswapMode, cdkStackArtifact);
            // THEN
            expect(deployStackResult).not.toBeUndefined();
            expect(mockLambdaInvoke).toHaveBeenCalledWith({
                FunctionName: 'a-lambda-arn',
                Payload: JSON.stringify({
                    ...payloadWithoutCustomResProps,
                    ResourceProperties: {
                        SourceObjectKeys: ['src-key-new'],
                        SourceBucketNames: ['src-bucket'],
                        DestinationBucketName: 'dest-bucket',
                    },
                }),
            });
        }
    });
    test('throws an error when the serviceToken fails evaluation in the template', async () => {
        // GIVEN
        setup.setCurrentCfnStackTemplate({
            Resources: {
                S3Deployment: {
                    Type: 'Custom::CDKBucketDeployment',
                    Properties: {
                        ServiceToken: {
                            Ref: 'BadLamba',
                        },
                        SourceBucketNames: ['src-bucket'],
                        SourceObjectKeys: ['src-key-old'],
                        DestinationBucketName: 'dest-bucket',
                    },
                },
            },
        });
        const cdkStackArtifact = setup.cdkStackArtifactOf({
            template: {
                Resources: {
                    S3Deployment: {
                        Type: 'Custom::CDKBucketDeployment',
                        Properties: {
                            ServiceToken: {
                                Ref: 'BadLamba',
                            },
                            SourceBucketNames: ['src-bucket'],
                            SourceObjectKeys: ['src-key-new'],
                            DestinationBucketName: 'dest-bucket',
                        },
                    },
                },
            },
        });
        // WHEN
        await expect(() => hotswapMockSdkProvider.tryHotswapDeployment(hotswapMode, cdkStackArtifact)).rejects.toThrow(/Parameter or resource 'BadLamba' could not be found for evaluation/);
        expect(mockLambdaInvoke).not.toHaveBeenCalled();
    });
    describe('old-style synthesis', () => {
        const parameters = {
            WebsiteBucketParamOld: { Type: 'String' },
            WebsiteBucketParamNew: { Type: 'String' },
            DifferentBucketParamNew: { Type: 'String' },
        };
        const serviceRole = {
            Type: 'AWS::IAM::Role',
            Properties: {
                AssumeRolePolicyDocument: {
                    Statement: [
                        {
                            Action: 'sts:AssumeRole',
                            Effect: 'Allow',
                            Principal: {
                                Service: 'lambda.amazonaws.com',
                            },
                        },
                    ],
                    Version: '2012-10-17',
                },
            },
        };
        const policyOld = {
            Type: 'AWS::IAM::Policy',
            Properties: {
                PolicyName: 'my-policy-old',
                Roles: [
                    { Ref: 'ServiceRole' },
                ],
                PolicyDocument: {
                    Statement: [
                        {
                            Action: ['s3:GetObject*'],
                            Effect: 'Allow',
                            Resource: {
                                Ref: 'WebsiteBucketParamOld',
                            },
                        },
                    ],
                },
            },
        };
        const policyNew = {
            Type: 'AWS::IAM::Policy',
            Properties: {
                PolicyName: 'my-policy-new',
                Roles: [
                    { Ref: 'ServiceRole' },
                ],
                PolicyDocument: {
                    Statement: [
                        {
                            Action: ['s3:GetObject*'],
                            Effect: 'Allow',
                            Resource: {
                                Ref: 'WebsiteBucketParamNew',
                            },
                        },
                    ],
                },
            },
        };
        const policy2Old = {
            Type: 'AWS::IAM::Policy',
            Properties: {
                PolicyName: 'my-policy-old-2',
                Roles: [
                    { Ref: 'ServiceRole' },
                ],
                PolicyDocument: {
                    Statement: [
                        {
                            Action: ['s3:GetObject*'],
                            Effect: 'Allow',
                            Resource: {
                                Ref: 'WebsiteBucketParamOld',
                            },
                        },
                    ],
                },
            },
        };
        const policy2New = {
            Type: 'AWS::IAM::Policy',
            Properties: {
                PolicyName: 'my-policy-new-2',
                Roles: [
                    { Ref: 'ServiceRole2' },
                ],
                PolicyDocument: {
                    Statement: [
                        {
                            Action: ['s3:GetObject*'],
                            Effect: 'Allow',
                            Resource: {
                                Ref: 'DifferentBucketParamOld',
                            },
                        },
                    ],
                },
            },
        };
        const deploymentLambda = {
            Type: 'AWS::Lambda::Function',
            Role: {
                'Fn::GetAtt': [
                    'ServiceRole',
                    'Arn',
                ],
            },
        };
        const s3DeploymentOld = {
            Type: 'Custom::CDKBucketDeployment',
            Properties: {
                ServiceToken: {
                    'Fn::GetAtt': [
                        'S3DeploymentLambda',
                        'Arn',
                    ],
                },
                SourceBucketNames: ['src-bucket-old'],
                SourceObjectKeys: ['src-key-old'],
                DestinationBucketName: 'WebsiteBucketOld',
            },
        };
        const s3DeploymentNew = {
            Type: 'Custom::CDKBucketDeployment',
            Properties: {
                ServiceToken: {
                    'Fn::GetAtt': [
                        'S3DeploymentLambda',
                        'Arn',
                    ],
                },
                SourceBucketNames: ['src-bucket-new'],
                SourceObjectKeys: ['src-key-new'],
                DestinationBucketName: 'WebsiteBucketNew',
            },
        };
        beforeEach(() => {
            setup.pushStackResourceSummaries(setup.stackSummaryOf('S3DeploymentLambda', 'AWS::Lambda::Function', 'my-deployment-lambda'), setup.stackSummaryOf('ServiceRole', 'AWS::IAM::Role', 'my-service-role'));
        });
        test('calls the lambdaInvoke() API when it receives an asset difference in an S3 bucket deployment and an IAM Policy difference using old-style synthesis', async () => {
            // GIVEN
            setup.setCurrentCfnStackTemplate({
                Resources: {
                    Parameters: parameters,
                    ServiceRole: serviceRole,
                    Policy: policyOld,
                    S3DeploymentLambda: deploymentLambda,
                    S3Deployment: s3DeploymentOld,
                },
            });
            const cdkStackArtifact = setup.cdkStackArtifactOf({
                template: {
                    Resources: {
                        Parameters: parameters,
                        ServiceRole: serviceRole,
                        Policy: policyNew,
                        S3DeploymentLambda: deploymentLambda,
                        S3Deployment: s3DeploymentNew,
                    },
                },
            });
            // WHEN
            const deployStackResult = await hotswapMockSdkProvider.tryHotswapDeployment(hotswapMode, cdkStackArtifact, { WebsiteBucketParamOld: 'WebsiteBucketOld', WebsiteBucketParamNew: 'WebsiteBucketNew' });
            // THEN
            expect(deployStackResult).not.toBeUndefined();
            expect(mockLambdaInvoke).toHaveBeenCalledWith({
                FunctionName: 'arn:aws:lambda:here:123456789012:function:my-deployment-lambda',
                Payload: JSON.stringify({
                    ...payloadWithoutCustomResProps,
                    ResourceProperties: {
                        SourceBucketNames: ['src-bucket-new'],
                        SourceObjectKeys: ['src-key-new'],
                        DestinationBucketName: 'WebsiteBucketNew',
                    },
                }),
            });
        });
        test(`does not call the lambdaInvoke() API when the difference in the S3 deployment is referred to in one IAM policy change but not another
          in CLASSIC mode but does in HOTSWAP_ONLY`, async () => {
            // GIVEN
            setup.setCurrentCfnStackTemplate({
                Resources: {
                    ServiceRole: serviceRole,
                    Policy1: policyOld,
                    Policy2: policy2Old,
                    S3DeploymentLambda: deploymentLambda,
                    S3Deployment: s3DeploymentOld,
                },
            });
            const cdkStackArtifact = setup.cdkStackArtifactOf({
                template: {
                    Resources: {
                        ServiceRole: serviceRole,
                        Policy1: policyNew,
                        Policy2: {
                            Properties: {
                                Roles: [
                                    { Ref: 'ServiceRole' },
                                    'different-role',
                                ],
                                PolicyDocument: {
                                    Statement: [
                                        {
                                            Action: ['s3:GetObject*'],
                                            Effect: 'Allow',
                                            Resource: {
                                                'Fn::GetAtt': [
                                                    'DifferentBucketNew',
                                                    'Arn',
                                                ],
                                            },
                                        },
                                    ],
                                },
                            },
                        },
                        S3DeploymentLambda: deploymentLambda,
                        S3Deployment: s3DeploymentNew,
                    },
                },
            });
            if (hotswapMode === common_1.HotswapMode.FALL_BACK) {
                // WHEN
                const deployStackResult = await hotswapMockSdkProvider.tryHotswapDeployment(hotswapMode, cdkStackArtifact);
                // THEN
                expect(deployStackResult).toBeUndefined();
                expect(mockLambdaInvoke).not.toHaveBeenCalled();
            }
            else if (hotswapMode === common_1.HotswapMode.HOTSWAP_ONLY) {
                // WHEN
                const deployStackResult = await hotswapMockSdkProvider.tryHotswapDeployment(hotswapMode, cdkStackArtifact);
                // THEN
                expect(deployStackResult).not.toBeUndefined();
                expect(mockLambdaInvoke).toHaveBeenCalledWith({
                    FunctionName: 'arn:aws:lambda:here:123456789012:function:my-deployment-lambda',
                    Payload: JSON.stringify({
                        ...payloadWithoutCustomResProps,
                        ResourceProperties: {
                            SourceBucketNames: ['src-bucket-new'],
                            SourceObjectKeys: ['src-key-new'],
                            DestinationBucketName: 'WebsiteBucketNew',
                        },
                    }),
                });
            }
        });
        test(`does not call the lambdaInvoke() API when the lambda that references the role is referred to by something other than an S3 deployment
          in CLASSIC mode but does in HOTSWAP_ONLY mode`, async () => {
            // GIVEN
            setup.setCurrentCfnStackTemplate({
                Resources: {
                    ServiceRole: serviceRole,
                    Policy: policyOld,
                    S3DeploymentLambda: deploymentLambda,
                    S3Deployment: s3DeploymentOld,
                    Endpoint: {
                        Type: 'AWS::Lambda::Permission',
                        Properties: {
                            Action: 'lambda:InvokeFunction',
                            FunctionName: {
                                'Fn::GetAtt': [
                                    'S3DeploymentLambda',
                                    'Arn',
                                ],
                            },
                            Principal: 'apigateway.amazonaws.com',
                        },
                    },
                },
            });
            const cdkStackArtifact = setup.cdkStackArtifactOf({
                template: {
                    Resources: {
                        ServiceRole: serviceRole,
                        Policy: policyNew,
                        S3DeploymentLambda: deploymentLambda,
                        S3Deployment: s3DeploymentNew,
                        Endpoint: {
                            Type: 'AWS::Lambda::Permission',
                            Properties: {
                                Action: 'lambda:InvokeFunction',
                                FunctionName: {
                                    'Fn::GetAtt': [
                                        'S3DeploymentLambda',
                                        'Arn',
                                    ],
                                },
                                Principal: 'apigateway.amazonaws.com',
                            },
                        },
                    },
                },
            });
            if (hotswapMode === common_1.HotswapMode.FALL_BACK) {
                // WHEN
                const deployStackResult = await hotswapMockSdkProvider.tryHotswapDeployment(hotswapMode, cdkStackArtifact);
                // THEN
                expect(deployStackResult).toBeUndefined();
                expect(mockLambdaInvoke).not.toHaveBeenCalled();
            }
            else if (hotswapMode === common_1.HotswapMode.HOTSWAP_ONLY) {
                // WHEN
                const deployStackResult = await hotswapMockSdkProvider.tryHotswapDeployment(hotswapMode, cdkStackArtifact);
                // THEN
                expect(deployStackResult).not.toBeUndefined();
                expect(mockLambdaInvoke).toHaveBeenCalledWith({
                    FunctionName: 'arn:aws:lambda:here:123456789012:function:my-deployment-lambda',
                    Payload: JSON.stringify({
                        ...payloadWithoutCustomResProps,
                        ResourceProperties: {
                            SourceBucketNames: ['src-bucket-new'],
                            SourceObjectKeys: ['src-key-new'],
                            DestinationBucketName: 'WebsiteBucketNew',
                        },
                    }),
                });
            }
        });
        test('calls the lambdaInvoke() API when it receives an asset difference in two S3 bucket deployments and IAM Policy differences using old-style synthesis', async () => {
            // GIVEN
            const s3Deployment2Old = {
                Type: 'Custom::CDKBucketDeployment',
                Properties: {
                    ServiceToken: {
                        'Fn::GetAtt': [
                            'S3DeploymentLambda2',
                            'Arn',
                        ],
                    },
                    SourceBucketNames: ['src-bucket-old'],
                    SourceObjectKeys: ['src-key-old'],
                    DestinationBucketName: 'DifferentBucketOld',
                },
            };
            const s3Deployment2New = {
                Type: 'Custom::CDKBucketDeployment',
                Properties: {
                    ServiceToken: {
                        'Fn::GetAtt': [
                            'S3DeploymentLambda2',
                            'Arn',
                        ],
                    },
                    SourceBucketNames: ['src-bucket-new'],
                    SourceObjectKeys: ['src-key-new'],
                    DestinationBucketName: 'DifferentBucketNew',
                },
            };
            setup.setCurrentCfnStackTemplate({
                Resources: {
                    ServiceRole: serviceRole,
                    ServiceRole2: serviceRole,
                    Policy1: policyOld,
                    Policy2: policy2Old,
                    S3DeploymentLambda: deploymentLambda,
                    S3DeploymentLambda2: deploymentLambda,
                    S3Deployment: s3DeploymentOld,
                    S3Deployment2: s3Deployment2Old,
                },
            });
            const cdkStackArtifact = setup.cdkStackArtifactOf({
                template: {
                    Resources: {
                        Parameters: parameters,
                        ServiceRole: serviceRole,
                        ServiceRole2: serviceRole,
                        Policy1: policyNew,
                        Policy2: policy2New,
                        S3DeploymentLambda: deploymentLambda,
                        S3DeploymentLambda2: deploymentLambda,
                        S3Deployment: s3DeploymentNew,
                        S3Deployment2: s3Deployment2New,
                    },
                },
            });
            // WHEN
            setup.pushStackResourceSummaries(setup.stackSummaryOf('S3DeploymentLambda2', 'AWS::Lambda::Function', 'my-deployment-lambda-2'), setup.stackSummaryOf('ServiceRole2', 'AWS::IAM::Role', 'my-service-role-2'));
            const deployStackResult = await hotswapMockSdkProvider.tryHotswapDeployment(hotswapMode, cdkStackArtifact, {
                WebsiteBucketParamOld: 'WebsiteBucketOld',
                WebsiteBucketParamNew: 'WebsiteBucketNew',
                DifferentBucketParamNew: 'WebsiteBucketNew',
            });
            // THEN
            expect(deployStackResult).not.toBeUndefined();
            expect(mockLambdaInvoke).toHaveBeenCalledWith({
                FunctionName: 'arn:aws:lambda:here:123456789012:function:my-deployment-lambda',
                Payload: JSON.stringify({
                    ...payloadWithoutCustomResProps,
                    ResourceProperties: {
                        SourceBucketNames: ['src-bucket-new'],
                        SourceObjectKeys: ['src-key-new'],
                        DestinationBucketName: 'WebsiteBucketNew',
                    },
                }),
            });
            expect(mockLambdaInvoke).toHaveBeenCalledWith({
                FunctionName: 'arn:aws:lambda:here:123456789012:function:my-deployment-lambda-2',
                Payload: JSON.stringify({
                    ...payloadWithoutCustomResProps,
                    ResourceProperties: {
                        SourceBucketNames: ['src-bucket-new'],
                        SourceObjectKeys: ['src-key-new'],
                        DestinationBucketName: 'DifferentBucketNew',
                    },
                }),
            });
        });
        test(`does not call the lambdaInvoke() API when it receives an asset difference in an S3 bucket deployment that references two different policies
          in CLASSIC mode but does in HOTSWAP_ONLY mode`, async () => {
            // GIVEN
            setup.setCurrentCfnStackTemplate({
                Resources: {
                    ServiceRole: serviceRole,
                    Policy1: policyOld,
                    Policy2: policy2Old,
                    S3DeploymentLambda: deploymentLambda,
                    S3Deployment: s3DeploymentOld,
                },
            });
            const cdkStackArtifact = setup.cdkStackArtifactOf({
                template: {
                    Resources: {
                        ServiceRole: serviceRole,
                        Policy1: policyNew,
                        Policy2: {
                            Properties: {
                                Roles: [
                                    { Ref: 'ServiceRole' },
                                ],
                                PolicyDocument: {
                                    Statement: [
                                        {
                                            Action: ['s3:GetObject*'],
                                            Effect: 'Allow',
                                            Resource: {
                                                'Fn::GetAtt': [
                                                    'DifferentBucketNew',
                                                    'Arn',
                                                ],
                                            },
                                        },
                                    ],
                                },
                            },
                        },
                        S3DeploymentLambda: deploymentLambda,
                        S3Deployment: s3DeploymentNew,
                    },
                },
            });
            if (hotswapMode === common_1.HotswapMode.FALL_BACK) {
                // WHEN
                const deployStackResult = await hotswapMockSdkProvider.tryHotswapDeployment(hotswapMode, cdkStackArtifact);
                // THEN
                expect(deployStackResult).toBeUndefined();
                expect(mockLambdaInvoke).not.toHaveBeenCalled();
            }
            else if (hotswapMode === common_1.HotswapMode.HOTSWAP_ONLY) {
                // WHEN
                const deployStackResult = await hotswapMockSdkProvider.tryHotswapDeployment(hotswapMode, cdkStackArtifact);
                // THEN
                expect(deployStackResult).not.toBeUndefined();
                expect(mockLambdaInvoke).toHaveBeenCalledWith({
                    FunctionName: 'arn:aws:lambda:here:123456789012:function:my-deployment-lambda',
                    Payload: JSON.stringify({
                        ...payloadWithoutCustomResProps,
                        ResourceProperties: {
                            SourceBucketNames: ['src-bucket-new'],
                            SourceObjectKeys: ['src-key-new'],
                            DestinationBucketName: 'WebsiteBucketNew',
                        },
                    }),
                });
            }
        });
        test(`does not call the lambdaInvoke() API when a policy is referenced by a resource that is not an S3 deployment
          in CLASSIC mode but does in HOTSWAP_ONLY mode`, async () => {
            // GIVEN
            setup.setCurrentCfnStackTemplate({
                Resources: {
                    ServiceRole: serviceRole,
                    Policy1: policyOld,
                    S3DeploymentLambda: deploymentLambda,
                    S3Deployment: s3DeploymentOld,
                    NotADeployment: {
                        Type: 'AWS::Not::S3Deployment',
                        Properties: {
                            Prop: {
                                Ref: 'ServiceRole',
                            },
                        },
                    },
                },
            });
            const cdkStackArtifact = setup.cdkStackArtifactOf({
                template: {
                    Resources: {
                        ServiceRole: serviceRole,
                        Policy1: policyNew,
                        S3DeploymentLambda: deploymentLambda,
                        S3Deployment: s3DeploymentNew,
                        NotADeployment: {
                            Type: 'AWS::Not::S3Deployment',
                            Properties: {
                                Prop: {
                                    Ref: 'ServiceRole',
                                },
                            },
                        },
                    },
                },
            });
            if (hotswapMode === common_1.HotswapMode.FALL_BACK) {
                // WHEN
                const deployStackResult = await hotswapMockSdkProvider.tryHotswapDeployment(hotswapMode, cdkStackArtifact);
                // THEN
                expect(deployStackResult).toBeUndefined();
                expect(mockLambdaInvoke).not.toHaveBeenCalled();
            }
            else if (hotswapMode === common_1.HotswapMode.HOTSWAP_ONLY) {
                // WHEN
                const deployStackResult = await hotswapMockSdkProvider.tryHotswapDeployment(hotswapMode, cdkStackArtifact);
                // THEN
                expect(deployStackResult).not.toBeUndefined();
                expect(mockLambdaInvoke).toHaveBeenCalledWith({
                    FunctionName: 'arn:aws:lambda:here:123456789012:function:my-deployment-lambda',
                    Payload: JSON.stringify({
                        ...payloadWithoutCustomResProps,
                        ResourceProperties: {
                            SourceBucketNames: ['src-bucket-new'],
                            SourceObjectKeys: ['src-key-new'],
                            DestinationBucketName: 'WebsiteBucketNew',
                        },
                    }),
                });
            }
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiczMtYnVja2V0LWhvdHN3YXAtZGVwbG95bWVudHMudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInMzLWJ1Y2tldC1ob3Rzd2FwLWRlcGxveW1lbnRzLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFFQSw4Q0FBOEM7QUFDOUMsNERBQThEO0FBQzlELDBGQUFpRjtBQUVqRixJQUFJLGdCQUE2RixDQUFDO0FBQ2xHLElBQUksc0JBQW9ELENBQUM7QUFFekQsTUFBTSw0QkFBNEIsR0FBRztJQUNuQyxXQUFXLEVBQUUsUUFBUTtJQUNyQixXQUFXLEVBQUUsdUNBQWU7SUFDNUIsa0JBQWtCLEVBQUUsdUNBQWU7SUFDbkMsT0FBTyxFQUFFLHVDQUFlO0lBQ3hCLFNBQVMsRUFBRSx1Q0FBZTtJQUMxQixpQkFBaUIsRUFBRSx1Q0FBZTtDQUNuQyxDQUFDO0FBRUYsVUFBVSxDQUFDLEdBQUcsRUFBRTtJQUNkLHNCQUFzQixHQUFHLEtBQUssQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO0lBQ25ELGdCQUFnQixHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztJQUM3QixzQkFBc0IsQ0FBQyxtQkFBbUIsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0FBQy9ELENBQUMsQ0FBQyxDQUFDO0FBRUgsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLG9CQUFXLENBQUMsU0FBUyxFQUFFLG9CQUFXLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxXQUFXLEVBQUUsRUFBRTtJQUMxRixJQUFJLENBQUMsNkpBQTZKLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDN0ssUUFBUTtRQUNSLEtBQUssQ0FBQywwQkFBMEIsQ0FBQztZQUMvQixTQUFTLEVBQUU7Z0JBQ1QsWUFBWSxFQUFFO29CQUNaLElBQUksRUFBRSw2QkFBNkI7b0JBQ25DLFVBQVUsRUFBRTt3QkFDVixZQUFZLEVBQUUsY0FBYzt3QkFDNUIsaUJBQWlCLEVBQUUsQ0FBQyxZQUFZLENBQUM7d0JBQ2pDLGdCQUFnQixFQUFFLENBQUMsYUFBYSxDQUFDO3dCQUNqQyxxQkFBcUIsRUFBRSxhQUFhO3dCQUNwQywwQkFBMEIsRUFBRSx3QkFBd0I7cUJBQ3JEO2lCQUNGO2FBQ0Y7U0FDRixDQUFDLENBQUM7UUFDSCxNQUFNLGdCQUFnQixHQUFHLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQztZQUNoRCxRQUFRLEVBQUU7Z0JBQ1IsU0FBUyxFQUFFO29CQUNULFlBQVksRUFBRTt3QkFDWixJQUFJLEVBQUUsNkJBQTZCO3dCQUNuQyxVQUFVLEVBQUU7NEJBQ1YsWUFBWSxFQUFFLGNBQWM7NEJBQzVCLGlCQUFpQixFQUFFLENBQUMsWUFBWSxDQUFDOzRCQUNqQyxnQkFBZ0IsRUFBRTtnQ0FDaEIsV0FBVyxFQUFFO29DQUNYLEdBQUc7b0NBQ0gsZ0JBQWdCO2lDQUNqQjs2QkFDRjs0QkFDRCxxQkFBcUIsRUFBRSxhQUFhOzRCQUNwQywwQkFBMEIsRUFBRSx3QkFBd0I7eUJBQ3JEO3FCQUNGO2lCQUNGO2FBQ0Y7U0FDRixDQUFDLENBQUM7UUFFSCxPQUFPO1FBQ1AsTUFBTSxpQkFBaUIsR0FBRyxNQUFNLHNCQUFzQixDQUFDLG9CQUFvQixDQUFDLFdBQVcsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO1FBRTNHLE9BQU87UUFDUCxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLENBQUM7UUFFOUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsb0JBQW9CLENBQUM7WUFDNUMsWUFBWSxFQUFFLGNBQWM7WUFDNUIsT0FBTyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUM7Z0JBQ3RCLEdBQUcsNEJBQTRCO2dCQUMvQixrQkFBa0IsRUFBRTtvQkFDbEIsaUJBQWlCLEVBQUUsQ0FBQyxZQUFZLENBQUM7b0JBQ2pDLGdCQUFnQixFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUM7b0JBQzFDLHFCQUFxQixFQUFFLGFBQWE7b0JBQ3BDLDBCQUEwQixFQUFFLHdCQUF3QjtpQkFDckQ7YUFDRixDQUFDO1NBQ0gsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFJLENBQUMseUlBQXlJLEVBQUUsS0FBSyxJQUFJLEVBQUU7UUFDekosUUFBUTtRQUNSLEtBQUssQ0FBQywwQkFBMEIsQ0FBQztZQUMvQixTQUFTLEVBQUU7Z0JBQ1QsWUFBWSxFQUFFO29CQUNaLElBQUksRUFBRSxnQ0FBZ0M7b0JBQ3RDLFVBQVUsRUFBRTt3QkFDVixnQkFBZ0IsRUFBRSxDQUFDLGFBQWEsQ0FBQztxQkFDbEM7aUJBQ0Y7YUFDRjtTQUNGLENBQUMsQ0FBQztRQUNILE1BQU0sZ0JBQWdCLEdBQUcsS0FBSyxDQUFDLGtCQUFrQixDQUFDO1lBQ2hELFFBQVEsRUFBRTtnQkFDUixTQUFTLEVBQUU7b0JBQ1QsWUFBWSxFQUFFO3dCQUNaLElBQUksRUFBRSxnQ0FBZ0M7d0JBQ3RDLFVBQVUsRUFBRTs0QkFDVixnQkFBZ0IsRUFBRSxDQUFDLGFBQWEsQ0FBQzt5QkFDbEM7cUJBQ0Y7aUJBQ0Y7YUFDRjtTQUNGLENBQUMsQ0FBQztRQUVILElBQUksV0FBVyxLQUFLLG9CQUFXLENBQUMsU0FBUyxFQUFFO1lBQ3pDLE9BQU87WUFDUCxNQUFNLGlCQUFpQixHQUFHLE1BQU0sc0JBQXNCLENBQUMsb0JBQW9CLENBQUMsV0FBVyxFQUFFLGdCQUFnQixDQUFDLENBQUM7WUFFM0csT0FBTztZQUNQLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQzFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1NBQ2pEO2FBQU0sSUFBSSxXQUFXLEtBQUssb0JBQVcsQ0FBQyxZQUFZLEVBQUU7WUFDbkQsT0FBTztZQUNQLE1BQU0saUJBQWlCLEdBQUcsTUFBTSxzQkFBc0IsQ0FBQyxvQkFBb0IsQ0FBQyxXQUFXLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztZQUUzRyxPQUFPO1lBQ1AsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDOUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUM7U0FDakQ7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyx1SEFBdUgsRUFBRSxLQUFLLElBQUksRUFBRTtRQUN2SSxRQUFRO1FBQ1IsS0FBSyxDQUFDLDBCQUEwQixDQUFDO1lBQy9CLFVBQVUsRUFBRTtnQkFDVixxQkFBcUIsRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUU7Z0JBQ3pDLHFCQUFxQixFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRTthQUMxQztZQUNELFNBQVMsRUFBRTtnQkFDVCxZQUFZLEVBQUU7b0JBQ1osSUFBSSxFQUFFLDZCQUE2QjtvQkFDbkMsVUFBVSxFQUFFO3dCQUNWLFlBQVksRUFBRSxjQUFjO3dCQUM1QixnQkFBZ0IsRUFBRSxDQUFDLGFBQWEsQ0FBQzt3QkFDakMsaUJBQWlCLEVBQUUsQ0FBQyxZQUFZLENBQUM7d0JBQ2pDLHFCQUFxQixFQUFFLGFBQWE7cUJBQ3JDO2lCQUNGO2dCQUNELE1BQU0sRUFBRTtvQkFDTixJQUFJLEVBQUUsa0JBQWtCO29CQUN4QixVQUFVLEVBQUU7d0JBQ1YsVUFBVSxFQUFFLFdBQVc7d0JBQ3ZCLGNBQWMsRUFBRTs0QkFDZCxTQUFTLEVBQUU7Z0NBQ1Q7b0NBQ0UsTUFBTSxFQUFFLENBQUMsZUFBZSxDQUFDO29DQUN6QixNQUFNLEVBQUUsT0FBTztvQ0FDZixRQUFRLEVBQUU7d0NBQ1IsR0FBRyxFQUFFLHVCQUF1QjtxQ0FDN0I7aUNBQ0Y7NkJBQ0Y7eUJBQ0Y7cUJBQ0Y7aUJBQ0Y7YUFDRjtTQUNGLENBQUMsQ0FBQztRQUNILE1BQU0sZ0JBQWdCLEdBQUcsS0FBSyxDQUFDLGtCQUFrQixDQUFDO1lBQ2hELFFBQVEsRUFBRTtnQkFDUixVQUFVLEVBQUU7b0JBQ1YscUJBQXFCLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFO29CQUN6QyxxQkFBcUIsRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUU7aUJBQzFDO2dCQUNELFNBQVMsRUFBRTtvQkFDVCxZQUFZLEVBQUU7d0JBQ1osSUFBSSxFQUFFLDZCQUE2Qjt3QkFDbkMsVUFBVSxFQUFFOzRCQUNWLFlBQVksRUFBRSxjQUFjOzRCQUM1QixnQkFBZ0IsRUFBRSxDQUFDLGFBQWEsQ0FBQzs0QkFDakMsaUJBQWlCLEVBQUUsQ0FBQyxZQUFZLENBQUM7NEJBQ2pDLHFCQUFxQixFQUFFLGFBQWE7eUJBQ3JDO3FCQUNGO29CQUNELE1BQU0sRUFBRTt3QkFDTixJQUFJLEVBQUUsa0JBQWtCO3dCQUN4QixVQUFVLEVBQUU7NEJBQ1YsVUFBVSxFQUFFLFdBQVc7NEJBQ3ZCLGNBQWMsRUFBRTtnQ0FDZCxTQUFTLEVBQUU7b0NBQ1Q7d0NBQ0UsTUFBTSxFQUFFLENBQUMsZUFBZSxDQUFDO3dDQUN6QixNQUFNLEVBQUUsT0FBTzt3Q0FDZixRQUFRLEVBQUU7NENBQ1IsR0FBRyxFQUFFLHVCQUF1Qjt5Q0FDN0I7cUNBQ0Y7aUNBQ0Y7NkJBQ0Y7eUJBQ0Y7cUJBQ0Y7aUJBQ0Y7YUFDRjtTQUNGLENBQUMsQ0FBQztRQUVILElBQUksV0FBVyxLQUFLLG9CQUFXLENBQUMsU0FBUyxFQUFFO1lBQ3pDLE9BQU87WUFDUCxNQUFNLGlCQUFpQixHQUFHLE1BQU0sc0JBQXNCLENBQUMsb0JBQW9CLENBQUMsV0FBVyxFQUFFLGdCQUFnQixDQUFDLENBQUM7WUFFM0csT0FBTztZQUNQLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQzFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1NBQ2pEO2FBQU0sSUFBSSxXQUFXLEtBQUssb0JBQVcsQ0FBQyxZQUFZLEVBQUU7WUFDbkQsT0FBTztZQUNQLE1BQU0saUJBQWlCLEdBQUcsTUFBTSxzQkFBc0IsQ0FBQyxvQkFBb0IsQ0FBQyxXQUFXLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztZQUUzRyxPQUFPO1lBQ1AsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLG9CQUFvQixDQUFDO2dCQUM1QyxZQUFZLEVBQUUsY0FBYztnQkFDNUIsT0FBTyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUM7b0JBQ3RCLEdBQUcsNEJBQTRCO29CQUMvQixrQkFBa0IsRUFBRTt3QkFDbEIsZ0JBQWdCLEVBQUUsQ0FBQyxhQUFhLENBQUM7d0JBQ2pDLGlCQUFpQixFQUFFLENBQUMsWUFBWSxDQUFDO3dCQUNqQyxxQkFBcUIsRUFBRSxhQUFhO3FCQUNyQztpQkFDRixDQUFDO2FBQ0gsQ0FBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksQ0FBQyx3RUFBd0UsRUFBRSxLQUFLLElBQUksRUFBRTtRQUN4RixRQUFRO1FBQ1IsS0FBSyxDQUFDLDBCQUEwQixDQUFDO1lBQy9CLFNBQVMsRUFBRTtnQkFDVCxZQUFZLEVBQUU7b0JBQ1osSUFBSSxFQUFFLDZCQUE2QjtvQkFDbkMsVUFBVSxFQUFFO3dCQUNWLFlBQVksRUFBRTs0QkFDWixHQUFHLEVBQUUsVUFBVTt5QkFDaEI7d0JBQ0QsaUJBQWlCLEVBQUUsQ0FBQyxZQUFZLENBQUM7d0JBQ2pDLGdCQUFnQixFQUFFLENBQUMsYUFBYSxDQUFDO3dCQUNqQyxxQkFBcUIsRUFBRSxhQUFhO3FCQUNyQztpQkFDRjthQUNGO1NBQ0YsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxnQkFBZ0IsR0FBRyxLQUFLLENBQUMsa0JBQWtCLENBQUM7WUFDaEQsUUFBUSxFQUFFO2dCQUNSLFNBQVMsRUFBRTtvQkFDVCxZQUFZLEVBQUU7d0JBQ1osSUFBSSxFQUFFLDZCQUE2Qjt3QkFDbkMsVUFBVSxFQUFFOzRCQUNWLFlBQVksRUFBRTtnQ0FDWixHQUFHLEVBQUUsVUFBVTs2QkFDaEI7NEJBQ0QsaUJBQWlCLEVBQUUsQ0FBQyxZQUFZLENBQUM7NEJBQ2pDLGdCQUFnQixFQUFFLENBQUMsYUFBYSxDQUFDOzRCQUNqQyxxQkFBcUIsRUFBRSxhQUFhO3lCQUNyQztxQkFDRjtpQkFDRjthQUNGO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsT0FBTztRQUNQLE1BQU0sTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUNoQixzQkFBc0IsQ0FBQyxvQkFBb0IsQ0FBQyxXQUFXLEVBQUUsZ0JBQWdCLENBQUMsQ0FDM0UsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLG9FQUFvRSxDQUFDLENBQUM7UUFFeEYsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFDbEQsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO1FBQ25DLE1BQU0sVUFBVSxHQUFHO1lBQ2pCLHFCQUFxQixFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRTtZQUN6QyxxQkFBcUIsRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUU7WUFDekMsdUJBQXVCLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFO1NBQzVDLENBQUM7UUFFRixNQUFNLFdBQVcsR0FBRztZQUNsQixJQUFJLEVBQUUsZ0JBQWdCO1lBQ3RCLFVBQVUsRUFBRTtnQkFDVix3QkFBd0IsRUFBRTtvQkFDeEIsU0FBUyxFQUFFO3dCQUNUOzRCQUNFLE1BQU0sRUFBRSxnQkFBZ0I7NEJBQ3hCLE1BQU0sRUFBRSxPQUFPOzRCQUNmLFNBQVMsRUFBRTtnQ0FDVCxPQUFPLEVBQUUsc0JBQXNCOzZCQUNoQzt5QkFDRjtxQkFDRjtvQkFDRCxPQUFPLEVBQUUsWUFBWTtpQkFDdEI7YUFDRjtTQUNGLENBQUM7UUFFRixNQUFNLFNBQVMsR0FBRztZQUNoQixJQUFJLEVBQUUsa0JBQWtCO1lBQ3hCLFVBQVUsRUFBRTtnQkFDVixVQUFVLEVBQUUsZUFBZTtnQkFDM0IsS0FBSyxFQUFFO29CQUNMLEVBQUUsR0FBRyxFQUFFLGFBQWEsRUFBRTtpQkFDdkI7Z0JBQ0QsY0FBYyxFQUFFO29CQUNkLFNBQVMsRUFBRTt3QkFDVDs0QkFDRSxNQUFNLEVBQUUsQ0FBQyxlQUFlLENBQUM7NEJBQ3pCLE1BQU0sRUFBRSxPQUFPOzRCQUNmLFFBQVEsRUFBRTtnQ0FDUixHQUFHLEVBQUUsdUJBQXVCOzZCQUM3Qjt5QkFDRjtxQkFDRjtpQkFDRjthQUNGO1NBQ0YsQ0FBQztRQUVGLE1BQU0sU0FBUyxHQUFHO1lBQ2hCLElBQUksRUFBRSxrQkFBa0I7WUFDeEIsVUFBVSxFQUFFO2dCQUNWLFVBQVUsRUFBRSxlQUFlO2dCQUMzQixLQUFLLEVBQUU7b0JBQ0wsRUFBRSxHQUFHLEVBQUUsYUFBYSxFQUFFO2lCQUN2QjtnQkFDRCxjQUFjLEVBQUU7b0JBQ2QsU0FBUyxFQUFFO3dCQUNUOzRCQUNFLE1BQU0sRUFBRSxDQUFDLGVBQWUsQ0FBQzs0QkFDekIsTUFBTSxFQUFFLE9BQU87NEJBQ2YsUUFBUSxFQUFFO2dDQUNSLEdBQUcsRUFBRSx1QkFBdUI7NkJBQzdCO3lCQUNGO3FCQUNGO2lCQUNGO2FBQ0Y7U0FDRixDQUFDO1FBRUYsTUFBTSxVQUFVLEdBQUc7WUFDakIsSUFBSSxFQUFFLGtCQUFrQjtZQUN4QixVQUFVLEVBQUU7Z0JBQ1YsVUFBVSxFQUFFLGlCQUFpQjtnQkFDN0IsS0FBSyxFQUFFO29CQUNMLEVBQUUsR0FBRyxFQUFFLGFBQWEsRUFBRTtpQkFDdkI7Z0JBQ0QsY0FBYyxFQUFFO29CQUNkLFNBQVMsRUFBRTt3QkFDVDs0QkFDRSxNQUFNLEVBQUUsQ0FBQyxlQUFlLENBQUM7NEJBQ3pCLE1BQU0sRUFBRSxPQUFPOzRCQUNmLFFBQVEsRUFBRTtnQ0FDUixHQUFHLEVBQUUsdUJBQXVCOzZCQUM3Qjt5QkFDRjtxQkFDRjtpQkFDRjthQUNGO1NBQ0YsQ0FBQztRQUVGLE1BQU0sVUFBVSxHQUFHO1lBQ2pCLElBQUksRUFBRSxrQkFBa0I7WUFDeEIsVUFBVSxFQUFFO2dCQUNWLFVBQVUsRUFBRSxpQkFBaUI7Z0JBQzdCLEtBQUssRUFBRTtvQkFDTCxFQUFFLEdBQUcsRUFBRSxjQUFjLEVBQUU7aUJBQ3hCO2dCQUNELGNBQWMsRUFBRTtvQkFDZCxTQUFTLEVBQUU7d0JBQ1Q7NEJBQ0UsTUFBTSxFQUFFLENBQUMsZUFBZSxDQUFDOzRCQUN6QixNQUFNLEVBQUUsT0FBTzs0QkFDZixRQUFRLEVBQUU7Z0NBQ1IsR0FBRyxFQUFFLHlCQUF5Qjs2QkFDL0I7eUJBQ0Y7cUJBQ0Y7aUJBQ0Y7YUFDRjtTQUNGLENBQUM7UUFFRixNQUFNLGdCQUFnQixHQUFHO1lBQ3ZCLElBQUksRUFBRSx1QkFBdUI7WUFDN0IsSUFBSSxFQUFFO2dCQUNKLFlBQVksRUFBRTtvQkFDWixhQUFhO29CQUNiLEtBQUs7aUJBQ047YUFDRjtTQUNGLENBQUM7UUFFRixNQUFNLGVBQWUsR0FBRztZQUN0QixJQUFJLEVBQUUsNkJBQTZCO1lBQ25DLFVBQVUsRUFBRTtnQkFDVixZQUFZLEVBQUU7b0JBQ1osWUFBWSxFQUFFO3dCQUNaLG9CQUFvQjt3QkFDcEIsS0FBSztxQkFDTjtpQkFDRjtnQkFDRCxpQkFBaUIsRUFBRSxDQUFDLGdCQUFnQixDQUFDO2dCQUNyQyxnQkFBZ0IsRUFBRSxDQUFDLGFBQWEsQ0FBQztnQkFDakMscUJBQXFCLEVBQUUsa0JBQWtCO2FBQzFDO1NBQ0YsQ0FBQztRQUVGLE1BQU0sZUFBZSxHQUFHO1lBQ3RCLElBQUksRUFBRSw2QkFBNkI7WUFDbkMsVUFBVSxFQUFFO2dCQUNWLFlBQVksRUFBRTtvQkFDWixZQUFZLEVBQUU7d0JBQ1osb0JBQW9CO3dCQUNwQixLQUFLO3FCQUNOO2lCQUNGO2dCQUNELGlCQUFpQixFQUFFLENBQUMsZ0JBQWdCLENBQUM7Z0JBQ3JDLGdCQUFnQixFQUFFLENBQUMsYUFBYSxDQUFDO2dCQUNqQyxxQkFBcUIsRUFBRSxrQkFBa0I7YUFDMUM7U0FDRixDQUFDO1FBRUYsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUNkLEtBQUssQ0FBQywwQkFBMEIsQ0FDOUIsS0FBSyxDQUFDLGNBQWMsQ0FBQyxvQkFBb0IsRUFBRSx1QkFBdUIsRUFBRSxzQkFBc0IsQ0FBQyxFQUMzRixLQUFLLENBQUMsY0FBYyxDQUFDLGFBQWEsRUFBRSxnQkFBZ0IsRUFBRSxpQkFBaUIsQ0FBQyxDQUN6RSxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMscUpBQXFKLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDckssUUFBUTtZQUNSLEtBQUssQ0FBQywwQkFBMEIsQ0FBQztnQkFDL0IsU0FBUyxFQUFFO29CQUNULFVBQVUsRUFBRSxVQUFVO29CQUN0QixXQUFXLEVBQUUsV0FBVztvQkFDeEIsTUFBTSxFQUFFLFNBQVM7b0JBQ2pCLGtCQUFrQixFQUFFLGdCQUFnQjtvQkFDcEMsWUFBWSxFQUFFLGVBQWU7aUJBQzlCO2FBQ0YsQ0FBQyxDQUFDO1lBRUgsTUFBTSxnQkFBZ0IsR0FBRyxLQUFLLENBQUMsa0JBQWtCLENBQUM7Z0JBQ2hELFFBQVEsRUFBRTtvQkFDUixTQUFTLEVBQUU7d0JBQ1QsVUFBVSxFQUFFLFVBQVU7d0JBQ3RCLFdBQVcsRUFBRSxXQUFXO3dCQUN4QixNQUFNLEVBQUUsU0FBUzt3QkFDakIsa0JBQWtCLEVBQUUsZ0JBQWdCO3dCQUNwQyxZQUFZLEVBQUUsZUFBZTtxQkFDOUI7aUJBQ0Y7YUFDRixDQUFDLENBQUM7WUFFSCxPQUFPO1lBQ1AsTUFBTSxpQkFBaUIsR0FBRyxNQUFNLHNCQUFzQixDQUFDLG9CQUFvQixDQUFDLFdBQVcsRUFBRSxnQkFBZ0IsRUFBRSxFQUFFLHFCQUFxQixFQUFFLGtCQUFrQixFQUFFLHFCQUFxQixFQUFFLGtCQUFrQixFQUFFLENBQUMsQ0FBQztZQUVyTSxPQUFPO1lBQ1AsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLG9CQUFvQixDQUFDO2dCQUM1QyxZQUFZLEVBQUUsZ0VBQWdFO2dCQUM5RSxPQUFPLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQztvQkFDdEIsR0FBRyw0QkFBNEI7b0JBQy9CLGtCQUFrQixFQUFFO3dCQUNsQixpQkFBaUIsRUFBRSxDQUFDLGdCQUFnQixDQUFDO3dCQUNyQyxnQkFBZ0IsRUFBRSxDQUFDLGFBQWEsQ0FBQzt3QkFDakMscUJBQXFCLEVBQUUsa0JBQWtCO3FCQUMxQztpQkFDRixDQUFDO2FBQ0gsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUM7bURBQzBDLEVBQy9DLEtBQUssSUFBSSxFQUFFO1lBQ1QsUUFBUTtZQUNSLEtBQUssQ0FBQywwQkFBMEIsQ0FBQztnQkFDL0IsU0FBUyxFQUFFO29CQUNULFdBQVcsRUFBRSxXQUFXO29CQUN4QixPQUFPLEVBQUUsU0FBUztvQkFDbEIsT0FBTyxFQUFFLFVBQVU7b0JBQ25CLGtCQUFrQixFQUFFLGdCQUFnQjtvQkFDcEMsWUFBWSxFQUFFLGVBQWU7aUJBQzlCO2FBQ0YsQ0FBQyxDQUFDO1lBRUgsTUFBTSxnQkFBZ0IsR0FBRyxLQUFLLENBQUMsa0JBQWtCLENBQUM7Z0JBQ2hELFFBQVEsRUFBRTtvQkFDUixTQUFTLEVBQUU7d0JBQ1QsV0FBVyxFQUFFLFdBQVc7d0JBQ3hCLE9BQU8sRUFBRSxTQUFTO3dCQUNsQixPQUFPLEVBQUU7NEJBQ1AsVUFBVSxFQUFFO2dDQUNWLEtBQUssRUFBRTtvQ0FDTCxFQUFFLEdBQUcsRUFBRSxhQUFhLEVBQUU7b0NBQ3RCLGdCQUFnQjtpQ0FDakI7Z0NBQ0QsY0FBYyxFQUFFO29DQUNkLFNBQVMsRUFBRTt3Q0FDVDs0Q0FDRSxNQUFNLEVBQUUsQ0FBQyxlQUFlLENBQUM7NENBQ3pCLE1BQU0sRUFBRSxPQUFPOzRDQUNmLFFBQVEsRUFBRTtnREFDUixZQUFZLEVBQUU7b0RBQ1osb0JBQW9CO29EQUNwQixLQUFLO2lEQUNOOzZDQUNGO3lDQUNGO3FDQUNGO2lDQUNGOzZCQUNGO3lCQUNGO3dCQUNELGtCQUFrQixFQUFFLGdCQUFnQjt3QkFDcEMsWUFBWSxFQUFFLGVBQWU7cUJBQzlCO2lCQUNGO2FBQ0YsQ0FBQyxDQUFDO1lBRUgsSUFBSSxXQUFXLEtBQUssb0JBQVcsQ0FBQyxTQUFTLEVBQUU7Z0JBQ3pDLE9BQU87Z0JBQ1AsTUFBTSxpQkFBaUIsR0FBRyxNQUFNLHNCQUFzQixDQUFDLG9CQUFvQixDQUFDLFdBQVcsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO2dCQUUzRyxPQUFPO2dCQUNQLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLGFBQWEsRUFBRSxDQUFDO2dCQUMxQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQzthQUNqRDtpQkFBTSxJQUFJLFdBQVcsS0FBSyxvQkFBVyxDQUFDLFlBQVksRUFBRTtnQkFDbkQsT0FBTztnQkFDUCxNQUFNLGlCQUFpQixHQUFHLE1BQU0sc0JBQXNCLENBQUMsb0JBQW9CLENBQUMsV0FBVyxFQUFFLGdCQUFnQixDQUFDLENBQUM7Z0JBRTNHLE9BQU87Z0JBQ1AsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxDQUFDO2dCQUM5QyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztvQkFDNUMsWUFBWSxFQUFFLGdFQUFnRTtvQkFDOUUsT0FBTyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUM7d0JBQ3RCLEdBQUcsNEJBQTRCO3dCQUMvQixrQkFBa0IsRUFBRTs0QkFDbEIsaUJBQWlCLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQzs0QkFDckMsZ0JBQWdCLEVBQUUsQ0FBQyxhQUFhLENBQUM7NEJBQ2pDLHFCQUFxQixFQUFFLGtCQUFrQjt5QkFDMUM7cUJBQ0YsQ0FBQztpQkFDSCxDQUFDLENBQUM7YUFDSjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDO3dEQUMrQyxFQUNwRCxLQUFLLElBQUksRUFBRTtZQUNULFFBQVE7WUFDUixLQUFLLENBQUMsMEJBQTBCLENBQUM7Z0JBQy9CLFNBQVMsRUFBRTtvQkFDVCxXQUFXLEVBQUUsV0FBVztvQkFDeEIsTUFBTSxFQUFFLFNBQVM7b0JBQ2pCLGtCQUFrQixFQUFFLGdCQUFnQjtvQkFDcEMsWUFBWSxFQUFFLGVBQWU7b0JBQzdCLFFBQVEsRUFBRTt3QkFDUixJQUFJLEVBQUUseUJBQXlCO3dCQUMvQixVQUFVLEVBQUU7NEJBQ1YsTUFBTSxFQUFFLHVCQUF1Qjs0QkFDL0IsWUFBWSxFQUFFO2dDQUNaLFlBQVksRUFBRTtvQ0FDWixvQkFBb0I7b0NBQ3BCLEtBQUs7aUNBQ047NkJBQ0Y7NEJBQ0QsU0FBUyxFQUFFLDBCQUEwQjt5QkFDdEM7cUJBQ0Y7aUJBQ0Y7YUFDRixDQUFDLENBQUM7WUFFSCxNQUFNLGdCQUFnQixHQUFHLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQztnQkFDaEQsUUFBUSxFQUFFO29CQUNSLFNBQVMsRUFBRTt3QkFDVCxXQUFXLEVBQUUsV0FBVzt3QkFDeEIsTUFBTSxFQUFFLFNBQVM7d0JBQ2pCLGtCQUFrQixFQUFFLGdCQUFnQjt3QkFDcEMsWUFBWSxFQUFFLGVBQWU7d0JBQzdCLFFBQVEsRUFBRTs0QkFDUixJQUFJLEVBQUUseUJBQXlCOzRCQUMvQixVQUFVLEVBQUU7Z0NBQ1YsTUFBTSxFQUFFLHVCQUF1QjtnQ0FDL0IsWUFBWSxFQUFFO29DQUNaLFlBQVksRUFBRTt3Q0FDWixvQkFBb0I7d0NBQ3BCLEtBQUs7cUNBQ047aUNBQ0Y7Z0NBQ0QsU0FBUyxFQUFFLDBCQUEwQjs2QkFDdEM7eUJBQ0Y7cUJBQ0Y7aUJBQ0Y7YUFDRixDQUFDLENBQUM7WUFFSCxJQUFJLFdBQVcsS0FBSyxvQkFBVyxDQUFDLFNBQVMsRUFBRTtnQkFDekMsT0FBTztnQkFDUCxNQUFNLGlCQUFpQixHQUFHLE1BQU0sc0JBQXNCLENBQUMsb0JBQW9CLENBQUMsV0FBVyxFQUFFLGdCQUFnQixDQUFDLENBQUM7Z0JBRTNHLE9BQU87Z0JBQ1AsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7Z0JBQzFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO2FBQ2pEO2lCQUFNLElBQUksV0FBVyxLQUFLLG9CQUFXLENBQUMsWUFBWSxFQUFFO2dCQUNuRCxPQUFPO2dCQUNQLE1BQU0saUJBQWlCLEdBQUcsTUFBTSxzQkFBc0IsQ0FBQyxvQkFBb0IsQ0FBQyxXQUFXLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztnQkFFM0csT0FBTztnQkFDUCxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLENBQUM7Z0JBQzlDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLG9CQUFvQixDQUFDO29CQUM1QyxZQUFZLEVBQUUsZ0VBQWdFO29CQUM5RSxPQUFPLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQzt3QkFDdEIsR0FBRyw0QkFBNEI7d0JBQy9CLGtCQUFrQixFQUFFOzRCQUNsQixpQkFBaUIsRUFBRSxDQUFDLGdCQUFnQixDQUFDOzRCQUNyQyxnQkFBZ0IsRUFBRSxDQUFDLGFBQWEsQ0FBQzs0QkFDakMscUJBQXFCLEVBQUUsa0JBQWtCO3lCQUMxQztxQkFDRixDQUFDO2lCQUNILENBQUMsQ0FBQzthQUNKO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMscUpBQXFKLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDckssUUFBUTtZQUNSLE1BQU0sZ0JBQWdCLEdBQUc7Z0JBQ3ZCLElBQUksRUFBRSw2QkFBNkI7Z0JBQ25DLFVBQVUsRUFBRTtvQkFDVixZQUFZLEVBQUU7d0JBQ1osWUFBWSxFQUFFOzRCQUNaLHFCQUFxQjs0QkFDckIsS0FBSzt5QkFDTjtxQkFDRjtvQkFDRCxpQkFBaUIsRUFBRSxDQUFDLGdCQUFnQixDQUFDO29CQUNyQyxnQkFBZ0IsRUFBRSxDQUFDLGFBQWEsQ0FBQztvQkFDakMscUJBQXFCLEVBQUUsb0JBQW9CO2lCQUM1QzthQUNGLENBQUM7WUFFRixNQUFNLGdCQUFnQixHQUFHO2dCQUN2QixJQUFJLEVBQUUsNkJBQTZCO2dCQUNuQyxVQUFVLEVBQUU7b0JBQ1YsWUFBWSxFQUFFO3dCQUNaLFlBQVksRUFBRTs0QkFDWixxQkFBcUI7NEJBQ3JCLEtBQUs7eUJBQ047cUJBQ0Y7b0JBQ0QsaUJBQWlCLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQztvQkFDckMsZ0JBQWdCLEVBQUUsQ0FBQyxhQUFhLENBQUM7b0JBQ2pDLHFCQUFxQixFQUFFLG9CQUFvQjtpQkFDNUM7YUFDRixDQUFDO1lBRUYsS0FBSyxDQUFDLDBCQUEwQixDQUFDO2dCQUMvQixTQUFTLEVBQUU7b0JBQ1QsV0FBVyxFQUFFLFdBQVc7b0JBQ3hCLFlBQVksRUFBRSxXQUFXO29CQUN6QixPQUFPLEVBQUUsU0FBUztvQkFDbEIsT0FBTyxFQUFFLFVBQVU7b0JBQ25CLGtCQUFrQixFQUFFLGdCQUFnQjtvQkFDcEMsbUJBQW1CLEVBQUUsZ0JBQWdCO29CQUNyQyxZQUFZLEVBQUUsZUFBZTtvQkFDN0IsYUFBYSxFQUFFLGdCQUFnQjtpQkFDaEM7YUFDRixDQUFDLENBQUM7WUFFSCxNQUFNLGdCQUFnQixHQUFHLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQztnQkFDaEQsUUFBUSxFQUFFO29CQUNSLFNBQVMsRUFBRTt3QkFDVCxVQUFVLEVBQUUsVUFBVTt3QkFDdEIsV0FBVyxFQUFFLFdBQVc7d0JBQ3hCLFlBQVksRUFBRSxXQUFXO3dCQUN6QixPQUFPLEVBQUUsU0FBUzt3QkFDbEIsT0FBTyxFQUFFLFVBQVU7d0JBQ25CLGtCQUFrQixFQUFFLGdCQUFnQjt3QkFDcEMsbUJBQW1CLEVBQUUsZ0JBQWdCO3dCQUNyQyxZQUFZLEVBQUUsZUFBZTt3QkFDN0IsYUFBYSxFQUFFLGdCQUFnQjtxQkFDaEM7aUJBQ0Y7YUFDRixDQUFDLENBQUM7WUFFSCxPQUFPO1lBQ1AsS0FBSyxDQUFDLDBCQUEwQixDQUM5QixLQUFLLENBQUMsY0FBYyxDQUFDLHFCQUFxQixFQUFFLHVCQUF1QixFQUFFLHdCQUF3QixDQUFDLEVBQzlGLEtBQUssQ0FBQyxjQUFjLENBQUMsY0FBYyxFQUFFLGdCQUFnQixFQUFFLG1CQUFtQixDQUFDLENBQzVFLENBQUM7WUFFRixNQUFNLGlCQUFpQixHQUFHLE1BQU0sc0JBQXNCLENBQUMsb0JBQW9CLENBQUMsV0FBVyxFQUFFLGdCQUFnQixFQUFFO2dCQUN6RyxxQkFBcUIsRUFBRSxrQkFBa0I7Z0JBQ3pDLHFCQUFxQixFQUFFLGtCQUFrQjtnQkFDekMsdUJBQXVCLEVBQUUsa0JBQWtCO2FBQzVDLENBQUMsQ0FBQztZQUVILE9BQU87WUFDUCxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDOUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsb0JBQW9CLENBQUM7Z0JBQzVDLFlBQVksRUFBRSxnRUFBZ0U7Z0JBQzlFLE9BQU8sRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDO29CQUN0QixHQUFHLDRCQUE0QjtvQkFDL0Isa0JBQWtCLEVBQUU7d0JBQ2xCLGlCQUFpQixFQUFFLENBQUMsZ0JBQWdCLENBQUM7d0JBQ3JDLGdCQUFnQixFQUFFLENBQUMsYUFBYSxDQUFDO3dCQUNqQyxxQkFBcUIsRUFBRSxrQkFBa0I7cUJBQzFDO2lCQUNGLENBQUM7YUFDSCxDQUFDLENBQUM7WUFFSCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQztnQkFDNUMsWUFBWSxFQUFFLGtFQUFrRTtnQkFDaEYsT0FBTyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUM7b0JBQ3RCLEdBQUcsNEJBQTRCO29CQUMvQixrQkFBa0IsRUFBRTt3QkFDbEIsaUJBQWlCLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQzt3QkFDckMsZ0JBQWdCLEVBQUUsQ0FBQyxhQUFhLENBQUM7d0JBQ2pDLHFCQUFxQixFQUFFLG9CQUFvQjtxQkFDNUM7aUJBQ0YsQ0FBQzthQUNILENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDO3dEQUMrQyxFQUNwRCxLQUFLLElBQUksRUFBRTtZQUNULFFBQVE7WUFDUixLQUFLLENBQUMsMEJBQTBCLENBQUM7Z0JBQy9CLFNBQVMsRUFBRTtvQkFDVCxXQUFXLEVBQUUsV0FBVztvQkFDeEIsT0FBTyxFQUFFLFNBQVM7b0JBQ2xCLE9BQU8sRUFBRSxVQUFVO29CQUNuQixrQkFBa0IsRUFBRSxnQkFBZ0I7b0JBQ3BDLFlBQVksRUFBRSxlQUFlO2lCQUM5QjthQUNGLENBQUMsQ0FBQztZQUVILE1BQU0sZ0JBQWdCLEdBQUcsS0FBSyxDQUFDLGtCQUFrQixDQUFDO2dCQUNoRCxRQUFRLEVBQUU7b0JBQ1IsU0FBUyxFQUFFO3dCQUNULFdBQVcsRUFBRSxXQUFXO3dCQUN4QixPQUFPLEVBQUUsU0FBUzt3QkFDbEIsT0FBTyxFQUFFOzRCQUNQLFVBQVUsRUFBRTtnQ0FDVixLQUFLLEVBQUU7b0NBQ0wsRUFBRSxHQUFHLEVBQUUsYUFBYSxFQUFFO2lDQUN2QjtnQ0FDRCxjQUFjLEVBQUU7b0NBQ2QsU0FBUyxFQUFFO3dDQUNUOzRDQUNFLE1BQU0sRUFBRSxDQUFDLGVBQWUsQ0FBQzs0Q0FDekIsTUFBTSxFQUFFLE9BQU87NENBQ2YsUUFBUSxFQUFFO2dEQUNSLFlBQVksRUFBRTtvREFDWixvQkFBb0I7b0RBQ3BCLEtBQUs7aURBQ047NkNBQ0Y7eUNBQ0Y7cUNBQ0Y7aUNBQ0Y7NkJBQ0Y7eUJBQ0Y7d0JBQ0Qsa0JBQWtCLEVBQUUsZ0JBQWdCO3dCQUNwQyxZQUFZLEVBQUUsZUFBZTtxQkFDOUI7aUJBQ0Y7YUFDRixDQUFDLENBQUM7WUFFSCxJQUFJLFdBQVcsS0FBSyxvQkFBVyxDQUFDLFNBQVMsRUFBRTtnQkFDekMsT0FBTztnQkFDUCxNQUFNLGlCQUFpQixHQUFHLE1BQU0sc0JBQXNCLENBQUMsb0JBQW9CLENBQUMsV0FBVyxFQUFFLGdCQUFnQixDQUFDLENBQUM7Z0JBRTNHLE9BQU87Z0JBQ1AsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7Z0JBQzFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO2FBQ2pEO2lCQUFNLElBQUksV0FBVyxLQUFLLG9CQUFXLENBQUMsWUFBWSxFQUFFO2dCQUNuRCxPQUFPO2dCQUNQLE1BQU0saUJBQWlCLEdBQUcsTUFBTSxzQkFBc0IsQ0FBQyxvQkFBb0IsQ0FBQyxXQUFXLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztnQkFFM0csT0FBTztnQkFDUCxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLENBQUM7Z0JBQzlDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLG9CQUFvQixDQUFDO29CQUM1QyxZQUFZLEVBQUUsZ0VBQWdFO29CQUM5RSxPQUFPLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQzt3QkFDdEIsR0FBRyw0QkFBNEI7d0JBQy9CLGtCQUFrQixFQUFFOzRCQUNsQixpQkFBaUIsRUFBRSxDQUFDLGdCQUFnQixDQUFDOzRCQUNyQyxnQkFBZ0IsRUFBRSxDQUFDLGFBQWEsQ0FBQzs0QkFDakMscUJBQXFCLEVBQUUsa0JBQWtCO3lCQUMxQztxQkFDRixDQUFDO2lCQUNILENBQUMsQ0FBQzthQUNKO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUM7d0RBQytDLEVBQ3BELEtBQUssSUFBSSxFQUFFO1lBQ1QsUUFBUTtZQUNSLEtBQUssQ0FBQywwQkFBMEIsQ0FBQztnQkFDL0IsU0FBUyxFQUFFO29CQUNULFdBQVcsRUFBRSxXQUFXO29CQUN4QixPQUFPLEVBQUUsU0FBUztvQkFDbEIsa0JBQWtCLEVBQUUsZ0JBQWdCO29CQUNwQyxZQUFZLEVBQUUsZUFBZTtvQkFDN0IsY0FBYyxFQUFFO3dCQUNkLElBQUksRUFBRSx3QkFBd0I7d0JBQzlCLFVBQVUsRUFBRTs0QkFDVixJQUFJLEVBQUU7Z0NBQ0osR0FBRyxFQUFFLGFBQWE7NkJBQ25CO3lCQUNGO3FCQUNGO2lCQUNGO2FBQ0YsQ0FBQyxDQUFDO1lBRUgsTUFBTSxnQkFBZ0IsR0FBRyxLQUFLLENBQUMsa0JBQWtCLENBQUM7Z0JBQ2hELFFBQVEsRUFBRTtvQkFDUixTQUFTLEVBQUU7d0JBQ1QsV0FBVyxFQUFFLFdBQVc7d0JBQ3hCLE9BQU8sRUFBRSxTQUFTO3dCQUNsQixrQkFBa0IsRUFBRSxnQkFBZ0I7d0JBQ3BDLFlBQVksRUFBRSxlQUFlO3dCQUM3QixjQUFjLEVBQUU7NEJBQ2QsSUFBSSxFQUFFLHdCQUF3Qjs0QkFDOUIsVUFBVSxFQUFFO2dDQUNWLElBQUksRUFBRTtvQ0FDSixHQUFHLEVBQUUsYUFBYTtpQ0FDbkI7NkJBQ0Y7eUJBQ0Y7cUJBQ0Y7aUJBQ0Y7YUFDRixDQUFDLENBQUM7WUFFSCxJQUFJLFdBQVcsS0FBSyxvQkFBVyxDQUFDLFNBQVMsRUFBRTtnQkFDekMsT0FBTztnQkFDUCxNQUFNLGlCQUFpQixHQUFHLE1BQU0sc0JBQXNCLENBQUMsb0JBQW9CLENBQUMsV0FBVyxFQUFFLGdCQUFnQixDQUFDLENBQUM7Z0JBRTNHLE9BQU87Z0JBQ1AsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7Z0JBQzFDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO2FBQ2pEO2lCQUFNLElBQUksV0FBVyxLQUFLLG9CQUFXLENBQUMsWUFBWSxFQUFFO2dCQUNuRCxPQUFPO2dCQUNQLE1BQU0saUJBQWlCLEdBQUcsTUFBTSxzQkFBc0IsQ0FBQyxvQkFBb0IsQ0FBQyxXQUFXLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztnQkFFM0csT0FBTztnQkFDUCxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLENBQUM7Z0JBQzlDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLG9CQUFvQixDQUFDO29CQUM1QyxZQUFZLEVBQUUsZ0VBQWdFO29CQUM5RSxPQUFPLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQzt3QkFDdEIsR0FBRyw0QkFBNEI7d0JBQy9CLGtCQUFrQixFQUFFOzRCQUNsQixpQkFBaUIsRUFBRSxDQUFDLGdCQUFnQixDQUFDOzRCQUNyQyxnQkFBZ0IsRUFBRSxDQUFDLGFBQWEsQ0FBQzs0QkFDakMscUJBQXFCLEVBQUUsa0JBQWtCO3lCQUMxQztxQkFDRixDQUFDO2lCQUNILENBQUMsQ0FBQzthQUNKO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgaW1wb3J0L29yZGVyICovXG5pbXBvcnQgeyBMYW1iZGEgfSBmcm9tICdhd3Mtc2RrJztcbmltcG9ydCAqIGFzIHNldHVwIGZyb20gJy4vaG90c3dhcC10ZXN0LXNldHVwJztcbmltcG9ydCB7IEhvdHN3YXBNb2RlIH0gZnJvbSAnLi4vLi4vLi4vbGliL2FwaS9ob3Rzd2FwL2NvbW1vbic7XG5pbXBvcnQgeyBSRVFVSVJFRF9CWV9DRk4gfSBmcm9tICcuLi8uLi8uLi9saWIvYXBpL2hvdHN3YXAvczMtYnVja2V0LWRlcGxveW1lbnRzJztcblxubGV0IG1vY2tMYW1iZGFJbnZva2U6IChwYXJhbXM6IExhbWJkYS5UeXBlcy5JbnZvY2F0aW9uUmVxdWVzdCkgPT4gTGFtYmRhLlR5cGVzLkludm9jYXRpb25SZXNwb25zZTtcbmxldCBob3Rzd2FwTW9ja1Nka1Byb3ZpZGVyOiBzZXR1cC5Ib3Rzd2FwTW9ja1Nka1Byb3ZpZGVyO1xuXG5jb25zdCBwYXlsb2FkV2l0aG91dEN1c3RvbVJlc1Byb3BzID0ge1xuICBSZXF1ZXN0VHlwZTogJ1VwZGF0ZScsXG4gIFJlc3BvbnNlVVJMOiBSRVFVSVJFRF9CWV9DRk4sXG4gIFBoeXNpY2FsUmVzb3VyY2VJZDogUkVRVUlSRURfQllfQ0ZOLFxuICBTdGFja0lkOiBSRVFVSVJFRF9CWV9DRk4sXG4gIFJlcXVlc3RJZDogUkVRVUlSRURfQllfQ0ZOLFxuICBMb2dpY2FsUmVzb3VyY2VJZDogUkVRVUlSRURfQllfQ0ZOLFxufTtcblxuYmVmb3JlRWFjaCgoKSA9PiB7XG4gIGhvdHN3YXBNb2NrU2RrUHJvdmlkZXIgPSBzZXR1cC5zZXR1cEhvdHN3YXBUZXN0cygpO1xuICBtb2NrTGFtYmRhSW52b2tlID0gamVzdC5mbigpO1xuICBob3Rzd2FwTW9ja1Nka1Byb3ZpZGVyLnNldEludm9rZUxhbWJkYU1vY2sobW9ja0xhbWJkYUludm9rZSk7XG59KTtcblxuZGVzY3JpYmUuZWFjaChbSG90c3dhcE1vZGUuRkFMTF9CQUNLLCBIb3Rzd2FwTW9kZS5IT1RTV0FQX09OTFldKSgnJXAgbW9kZScsIChob3Rzd2FwTW9kZSkgPT4ge1xuICB0ZXN0KCdjYWxscyB0aGUgbGFtYmRhSW52b2tlKCkgQVBJIHdoZW4gaXQgcmVjZWl2ZXMgb25seSBhbiBhc3NldCBkaWZmZXJlbmNlIGluIGFuIFMzIGJ1Y2tldCBkZXBsb3ltZW50IGFuZCBldmFsdWF0ZXMgQ0ZOIGV4cHJlc3Npb25zIGluIFMzIERlcGxveW1lbnQgUHJvcGVydGllcycsIGFzeW5jICgpID0+IHtcbiAgICAvLyBHSVZFTlxuICAgIHNldHVwLnNldEN1cnJlbnRDZm5TdGFja1RlbXBsYXRlKHtcbiAgICAgIFJlc291cmNlczoge1xuICAgICAgICBTM0RlcGxveW1lbnQ6IHtcbiAgICAgICAgICBUeXBlOiAnQ3VzdG9tOjpDREtCdWNrZXREZXBsb3ltZW50JyxcbiAgICAgICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICBTZXJ2aWNlVG9rZW46ICdhLWxhbWJkYS1hcm4nLFxuICAgICAgICAgICAgU291cmNlQnVja2V0TmFtZXM6IFsnc3JjLWJ1Y2tldCddLFxuICAgICAgICAgICAgU291cmNlT2JqZWN0S2V5czogWydzcmMta2V5LW9sZCddLFxuICAgICAgICAgICAgRGVzdGluYXRpb25CdWNrZXROYW1lOiAnZGVzdC1idWNrZXQnLFxuICAgICAgICAgICAgRGVzdGluYXRpb25CdWNrZXRLZXlQcmVmaXg6ICdteS1rZXkvc29tZS1vbGQtcHJlZml4JyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBjb25zdCBjZGtTdGFja0FydGlmYWN0ID0gc2V0dXAuY2RrU3RhY2tBcnRpZmFjdE9mKHtcbiAgICAgIHRlbXBsYXRlOiB7XG4gICAgICAgIFJlc291cmNlczoge1xuICAgICAgICAgIFMzRGVwbG95bWVudDoge1xuICAgICAgICAgICAgVHlwZTogJ0N1c3RvbTo6Q0RLQnVja2V0RGVwbG95bWVudCcsXG4gICAgICAgICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgIFNlcnZpY2VUb2tlbjogJ2EtbGFtYmRhLWFybicsXG4gICAgICAgICAgICAgIFNvdXJjZUJ1Y2tldE5hbWVzOiBbJ3NyYy1idWNrZXQnXSxcbiAgICAgICAgICAgICAgU291cmNlT2JqZWN0S2V5czoge1xuICAgICAgICAgICAgICAgICdGbjo6U3BsaXQnOiBbXG4gICAgICAgICAgICAgICAgICAnLScsXG4gICAgICAgICAgICAgICAgICAna2V5MS1rZXkyLWtleTMnLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIERlc3RpbmF0aW9uQnVja2V0TmFtZTogJ2Rlc3QtYnVja2V0JyxcbiAgICAgICAgICAgICAgRGVzdGluYXRpb25CdWNrZXRLZXlQcmVmaXg6ICdteS1rZXkvc29tZS1uZXctcHJlZml4JyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICAvLyBXSEVOXG4gICAgY29uc3QgZGVwbG95U3RhY2tSZXN1bHQgPSBhd2FpdCBob3Rzd2FwTW9ja1Nka1Byb3ZpZGVyLnRyeUhvdHN3YXBEZXBsb3ltZW50KGhvdHN3YXBNb2RlLCBjZGtTdGFja0FydGlmYWN0KTtcblxuICAgIC8vIFRIRU5cbiAgICBleHBlY3QoZGVwbG95U3RhY2tSZXN1bHQpLm5vdC50b0JlVW5kZWZpbmVkKCk7XG5cbiAgICBleHBlY3QobW9ja0xhbWJkYUludm9rZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgRnVuY3Rpb25OYW1lOiAnYS1sYW1iZGEtYXJuJyxcbiAgICAgIFBheWxvYWQ6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgLi4ucGF5bG9hZFdpdGhvdXRDdXN0b21SZXNQcm9wcyxcbiAgICAgICAgUmVzb3VyY2VQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgU291cmNlQnVja2V0TmFtZXM6IFsnc3JjLWJ1Y2tldCddLFxuICAgICAgICAgIFNvdXJjZU9iamVjdEtleXM6IFsna2V5MScsICdrZXkyJywgJ2tleTMnXSxcbiAgICAgICAgICBEZXN0aW5hdGlvbkJ1Y2tldE5hbWU6ICdkZXN0LWJ1Y2tldCcsXG4gICAgICAgICAgRGVzdGluYXRpb25CdWNrZXRLZXlQcmVmaXg6ICdteS1rZXkvc29tZS1uZXctcHJlZml4JyxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdkb2VzIG5vdCBjYWxsIHRoZSBpbnZva2UoKSBBUEkgd2hlbiBhIHJlc291cmNlIHdpdGggdHlwZSB0aGF0IGlzIG5vdCBDdXN0b206OkNES0J1Y2tldERlcGxveW1lbnQgYnV0IGhhcyB0aGUgc2FtZSBwcm9wZXJ0aWVzIGlzIGNoYW5nZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBzZXR1cC5zZXRDdXJyZW50Q2ZuU3RhY2tUZW1wbGF0ZSh7XG4gICAgICBSZXNvdXJjZXM6IHtcbiAgICAgICAgUzNEZXBsb3ltZW50OiB7XG4gICAgICAgICAgVHlwZTogJ0N1c3RvbTo6Tm90Q0RLQnVja2V0RGVwbG95bWVudCcsXG4gICAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgICAgU291cmNlT2JqZWN0S2V5czogWydzcmMta2V5LW9sZCddLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICAgIGNvbnN0IGNka1N0YWNrQXJ0aWZhY3QgPSBzZXR1cC5jZGtTdGFja0FydGlmYWN0T2Yoe1xuICAgICAgdGVtcGxhdGU6IHtcbiAgICAgICAgUmVzb3VyY2VzOiB7XG4gICAgICAgICAgUzNEZXBsb3ltZW50OiB7XG4gICAgICAgICAgICBUeXBlOiAnQ3VzdG9tOjpOb3RDREtCdWNrZXREZXBsb3ltZW50JyxcbiAgICAgICAgICAgIFByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgU291cmNlT2JqZWN0S2V5czogWydzcmMta2V5LW5ldyddLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGlmIChob3Rzd2FwTW9kZSA9PT0gSG90c3dhcE1vZGUuRkFMTF9CQUNLKSB7XG4gICAgICAvLyBXSEVOXG4gICAgICBjb25zdCBkZXBsb3lTdGFja1Jlc3VsdCA9IGF3YWl0IGhvdHN3YXBNb2NrU2RrUHJvdmlkZXIudHJ5SG90c3dhcERlcGxveW1lbnQoaG90c3dhcE1vZGUsIGNka1N0YWNrQXJ0aWZhY3QpO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBleHBlY3QoZGVwbG95U3RhY2tSZXN1bHQpLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrTGFtYmRhSW52b2tlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0gZWxzZSBpZiAoaG90c3dhcE1vZGUgPT09IEhvdHN3YXBNb2RlLkhPVFNXQVBfT05MWSkge1xuICAgICAgLy8gV0hFTlxuICAgICAgY29uc3QgZGVwbG95U3RhY2tSZXN1bHQgPSBhd2FpdCBob3Rzd2FwTW9ja1Nka1Byb3ZpZGVyLnRyeUhvdHN3YXBEZXBsb3ltZW50KGhvdHN3YXBNb2RlLCBjZGtTdGFja0FydGlmYWN0KTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgZXhwZWN0KGRlcGxveVN0YWNrUmVzdWx0KS5ub3QudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGRlcGxveVN0YWNrUmVzdWx0Py5ub09wKS50b0VxdWFsKHRydWUpO1xuICAgICAgZXhwZWN0KG1vY2tMYW1iZGFJbnZva2UpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfVxuICB9KTtcblxuICB0ZXN0KCdkb2VzIG5vdCBjYWxsIHRoZSBpbnZva2VMYW1iZGEoKSBhcGkgaWYgdGhlIHVwZGF0ZWQgUG9saWN5IGhhcyBubyBSb2xlcyBpbiBDTEFTU0lDIG1vZGUgYnV0IGRvZXMgaW4gSE9UU1dBUF9PTkxZIG1vZGUnLCBhc3luYyAoKSA9PiB7XG4gICAgLy8gR0lWRU5cbiAgICBzZXR1cC5zZXRDdXJyZW50Q2ZuU3RhY2tUZW1wbGF0ZSh7XG4gICAgICBQYXJhbWV0ZXJzOiB7XG4gICAgICAgIFdlYnNpdGVCdWNrZXRQYXJhbU9sZDogeyBUeXBlOiAnU3RyaW5nJyB9LFxuICAgICAgICBXZWJzaXRlQnVja2V0UGFyYW1OZXc6IHsgVHlwZTogJ1N0cmluZycgfSxcbiAgICAgIH0sXG4gICAgICBSZXNvdXJjZXM6IHtcbiAgICAgICAgUzNEZXBsb3ltZW50OiB7XG4gICAgICAgICAgVHlwZTogJ0N1c3RvbTo6Q0RLQnVja2V0RGVwbG95bWVudCcsXG4gICAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgICAgU2VydmljZVRva2VuOiAnYS1sYW1iZGEtYXJuJyxcbiAgICAgICAgICAgIFNvdXJjZU9iamVjdEtleXM6IFsnc3JjLWtleS1vbGQnXSxcbiAgICAgICAgICAgIFNvdXJjZUJ1Y2tldE5hbWVzOiBbJ3NyYy1idWNrZXQnXSxcbiAgICAgICAgICAgIERlc3RpbmF0aW9uQnVja2V0TmFtZTogJ2Rlc3QtYnVja2V0JyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBQb2xpY3k6IHtcbiAgICAgICAgICBUeXBlOiAnQVdTOjpJQU06OlBvbGljeScsXG4gICAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgICAgUG9saWN5TmFtZTogJ215LXBvbGljeScsXG4gICAgICAgICAgICBQb2xpY3lEb2N1bWVudDoge1xuICAgICAgICAgICAgICBTdGF0ZW1lbnQ6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBBY3Rpb246IFsnczM6R2V0T2JqZWN0KiddLFxuICAgICAgICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgICAgICAgUmVzb3VyY2U6IHtcbiAgICAgICAgICAgICAgICAgICAgUmVmOiAnV2Vic2l0ZUJ1Y2tldFBhcmFtT2xkJyxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgY29uc3QgY2RrU3RhY2tBcnRpZmFjdCA9IHNldHVwLmNka1N0YWNrQXJ0aWZhY3RPZih7XG4gICAgICB0ZW1wbGF0ZToge1xuICAgICAgICBQYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgV2Vic2l0ZUJ1Y2tldFBhcmFtT2xkOiB7IFR5cGU6ICdTdHJpbmcnIH0sXG4gICAgICAgICAgV2Vic2l0ZUJ1Y2tldFBhcmFtTmV3OiB7IFR5cGU6ICdTdHJpbmcnIH0sXG4gICAgICAgIH0sXG4gICAgICAgIFJlc291cmNlczoge1xuICAgICAgICAgIFMzRGVwbG95bWVudDoge1xuICAgICAgICAgICAgVHlwZTogJ0N1c3RvbTo6Q0RLQnVja2V0RGVwbG95bWVudCcsXG4gICAgICAgICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgIFNlcnZpY2VUb2tlbjogJ2EtbGFtYmRhLWFybicsXG4gICAgICAgICAgICAgIFNvdXJjZU9iamVjdEtleXM6IFsnc3JjLWtleS1uZXcnXSxcbiAgICAgICAgICAgICAgU291cmNlQnVja2V0TmFtZXM6IFsnc3JjLWJ1Y2tldCddLFxuICAgICAgICAgICAgICBEZXN0aW5hdGlvbkJ1Y2tldE5hbWU6ICdkZXN0LWJ1Y2tldCcsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgUG9saWN5OiB7XG4gICAgICAgICAgICBUeXBlOiAnQVdTOjpJQU06OlBvbGljeScsXG4gICAgICAgICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgIFBvbGljeU5hbWU6ICdteS1wb2xpY3knLFxuICAgICAgICAgICAgICBQb2xpY3lEb2N1bWVudDoge1xuICAgICAgICAgICAgICAgIFN0YXRlbWVudDogW1xuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBBY3Rpb246IFsnczM6R2V0T2JqZWN0KiddLFxuICAgICAgICAgICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICAgICAgICAgIFJlc291cmNlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgUmVmOiAnV2Vic2l0ZUJ1Y2tldFBhcmFtTmV3JyxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBpZiAoaG90c3dhcE1vZGUgPT09IEhvdHN3YXBNb2RlLkZBTExfQkFDSykge1xuICAgICAgLy8gV0hFTlxuICAgICAgY29uc3QgZGVwbG95U3RhY2tSZXN1bHQgPSBhd2FpdCBob3Rzd2FwTW9ja1Nka1Byb3ZpZGVyLnRyeUhvdHN3YXBEZXBsb3ltZW50KGhvdHN3YXBNb2RlLCBjZGtTdGFja0FydGlmYWN0KTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgZXhwZWN0KGRlcGxveVN0YWNrUmVzdWx0KS50b0JlVW5kZWZpbmVkKCk7XG4gICAgICBleHBlY3QobW9ja0xhbWJkYUludm9rZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9IGVsc2UgaWYgKGhvdHN3YXBNb2RlID09PSBIb3Rzd2FwTW9kZS5IT1RTV0FQX09OTFkpIHtcbiAgICAgIC8vIFdIRU5cbiAgICAgIGNvbnN0IGRlcGxveVN0YWNrUmVzdWx0ID0gYXdhaXQgaG90c3dhcE1vY2tTZGtQcm92aWRlci50cnlIb3Rzd2FwRGVwbG95bWVudChob3Rzd2FwTW9kZSwgY2RrU3RhY2tBcnRpZmFjdCk7XG5cbiAgICAgIC8vIFRIRU5cbiAgICAgIGV4cGVjdChkZXBsb3lTdGFja1Jlc3VsdCkubm90LnRvQmVVbmRlZmluZWQoKTtcbiAgICAgIGV4cGVjdChtb2NrTGFtYmRhSW52b2tlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIEZ1bmN0aW9uTmFtZTogJ2EtbGFtYmRhLWFybicsXG4gICAgICAgIFBheWxvYWQ6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAuLi5wYXlsb2FkV2l0aG91dEN1c3RvbVJlc1Byb3BzLFxuICAgICAgICAgIFJlc291cmNlUHJvcGVydGllczoge1xuICAgICAgICAgICAgU291cmNlT2JqZWN0S2V5czogWydzcmMta2V5LW5ldyddLFxuICAgICAgICAgICAgU291cmNlQnVja2V0TmFtZXM6IFsnc3JjLWJ1Y2tldCddLFxuICAgICAgICAgICAgRGVzdGluYXRpb25CdWNrZXROYW1lOiAnZGVzdC1idWNrZXQnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICB0ZXN0KCd0aHJvd3MgYW4gZXJyb3Igd2hlbiB0aGUgc2VydmljZVRva2VuIGZhaWxzIGV2YWx1YXRpb24gaW4gdGhlIHRlbXBsYXRlJywgYXN5bmMgKCkgPT4ge1xuICAgIC8vIEdJVkVOXG4gICAgc2V0dXAuc2V0Q3VycmVudENmblN0YWNrVGVtcGxhdGUoe1xuICAgICAgUmVzb3VyY2VzOiB7XG4gICAgICAgIFMzRGVwbG95bWVudDoge1xuICAgICAgICAgIFR5cGU6ICdDdXN0b206OkNES0J1Y2tldERlcGxveW1lbnQnLFxuICAgICAgICAgIFByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgIFNlcnZpY2VUb2tlbjoge1xuICAgICAgICAgICAgICBSZWY6ICdCYWRMYW1iYScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgU291cmNlQnVja2V0TmFtZXM6IFsnc3JjLWJ1Y2tldCddLFxuICAgICAgICAgICAgU291cmNlT2JqZWN0S2V5czogWydzcmMta2V5LW9sZCddLFxuICAgICAgICAgICAgRGVzdGluYXRpb25CdWNrZXROYW1lOiAnZGVzdC1idWNrZXQnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICAgIGNvbnN0IGNka1N0YWNrQXJ0aWZhY3QgPSBzZXR1cC5jZGtTdGFja0FydGlmYWN0T2Yoe1xuICAgICAgdGVtcGxhdGU6IHtcbiAgICAgICAgUmVzb3VyY2VzOiB7XG4gICAgICAgICAgUzNEZXBsb3ltZW50OiB7XG4gICAgICAgICAgICBUeXBlOiAnQ3VzdG9tOjpDREtCdWNrZXREZXBsb3ltZW50JyxcbiAgICAgICAgICAgIFByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgU2VydmljZVRva2VuOiB7XG4gICAgICAgICAgICAgICAgUmVmOiAnQmFkTGFtYmEnLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBTb3VyY2VCdWNrZXROYW1lczogWydzcmMtYnVja2V0J10sXG4gICAgICAgICAgICAgIFNvdXJjZU9iamVjdEtleXM6IFsnc3JjLWtleS1uZXcnXSxcbiAgICAgICAgICAgICAgRGVzdGluYXRpb25CdWNrZXROYW1lOiAnZGVzdC1idWNrZXQnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFdIRU5cbiAgICBhd2FpdCBleHBlY3QoKCkgPT5cbiAgICAgIGhvdHN3YXBNb2NrU2RrUHJvdmlkZXIudHJ5SG90c3dhcERlcGxveW1lbnQoaG90c3dhcE1vZGUsIGNka1N0YWNrQXJ0aWZhY3QpLFxuICAgICkucmVqZWN0cy50b1Rocm93KC9QYXJhbWV0ZXIgb3IgcmVzb3VyY2UgJ0JhZExhbWJhJyBjb3VsZCBub3QgYmUgZm91bmQgZm9yIGV2YWx1YXRpb24vKTtcblxuICAgIGV4cGVjdChtb2NrTGFtYmRhSW52b2tlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnb2xkLXN0eWxlIHN5bnRoZXNpcycsICgpID0+IHtcbiAgICBjb25zdCBwYXJhbWV0ZXJzID0ge1xuICAgICAgV2Vic2l0ZUJ1Y2tldFBhcmFtT2xkOiB7IFR5cGU6ICdTdHJpbmcnIH0sXG4gICAgICBXZWJzaXRlQnVja2V0UGFyYW1OZXc6IHsgVHlwZTogJ1N0cmluZycgfSxcbiAgICAgIERpZmZlcmVudEJ1Y2tldFBhcmFtTmV3OiB7IFR5cGU6ICdTdHJpbmcnIH0sXG4gICAgfTtcblxuICAgIGNvbnN0IHNlcnZpY2VSb2xlID0ge1xuICAgICAgVHlwZTogJ0FXUzo6SUFNOjpSb2xlJyxcbiAgICAgIFByb3BlcnRpZXM6IHtcbiAgICAgICAgQXNzdW1lUm9sZVBvbGljeURvY3VtZW50OiB7XG4gICAgICAgICAgU3RhdGVtZW50OiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIEFjdGlvbjogJ3N0czpBc3N1bWVSb2xlJyxcbiAgICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgICBQcmluY2lwYWw6IHtcbiAgICAgICAgICAgICAgICBTZXJ2aWNlOiAnbGFtYmRhLmFtYXpvbmF3cy5jb20nLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIFZlcnNpb246ICcyMDEyLTEwLTE3JyxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIGNvbnN0IHBvbGljeU9sZCA9IHtcbiAgICAgIFR5cGU6ICdBV1M6OklBTTo6UG9saWN5JyxcbiAgICAgIFByb3BlcnRpZXM6IHtcbiAgICAgICAgUG9saWN5TmFtZTogJ215LXBvbGljeS1vbGQnLFxuICAgICAgICBSb2xlczogW1xuICAgICAgICAgIHsgUmVmOiAnU2VydmljZVJvbGUnIH0sXG4gICAgICAgIF0sXG4gICAgICAgIFBvbGljeURvY3VtZW50OiB7XG4gICAgICAgICAgU3RhdGVtZW50OiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIEFjdGlvbjogWydzMzpHZXRPYmplY3QqJ10sXG4gICAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgICAgUmVzb3VyY2U6IHtcbiAgICAgICAgICAgICAgICBSZWY6ICdXZWJzaXRlQnVja2V0UGFyYW1PbGQnLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgY29uc3QgcG9saWN5TmV3ID0ge1xuICAgICAgVHlwZTogJ0FXUzo6SUFNOjpQb2xpY3knLFxuICAgICAgUHJvcGVydGllczoge1xuICAgICAgICBQb2xpY3lOYW1lOiAnbXktcG9saWN5LW5ldycsXG4gICAgICAgIFJvbGVzOiBbXG4gICAgICAgICAgeyBSZWY6ICdTZXJ2aWNlUm9sZScgfSxcbiAgICAgICAgXSxcbiAgICAgICAgUG9saWN5RG9jdW1lbnQ6IHtcbiAgICAgICAgICBTdGF0ZW1lbnQ6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgQWN0aW9uOiBbJ3MzOkdldE9iamVjdConXSxcbiAgICAgICAgICAgICAgRWZmZWN0OiAnQWxsb3cnLFxuICAgICAgICAgICAgICBSZXNvdXJjZToge1xuICAgICAgICAgICAgICAgIFJlZjogJ1dlYnNpdGVCdWNrZXRQYXJhbU5ldycsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH07XG5cbiAgICBjb25zdCBwb2xpY3kyT2xkID0ge1xuICAgICAgVHlwZTogJ0FXUzo6SUFNOjpQb2xpY3knLFxuICAgICAgUHJvcGVydGllczoge1xuICAgICAgICBQb2xpY3lOYW1lOiAnbXktcG9saWN5LW9sZC0yJyxcbiAgICAgICAgUm9sZXM6IFtcbiAgICAgICAgICB7IFJlZjogJ1NlcnZpY2VSb2xlJyB9LFxuICAgICAgICBdLFxuICAgICAgICBQb2xpY3lEb2N1bWVudDoge1xuICAgICAgICAgIFN0YXRlbWVudDogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBBY3Rpb246IFsnczM6R2V0T2JqZWN0KiddLFxuICAgICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICAgIFJlc291cmNlOiB7XG4gICAgICAgICAgICAgICAgUmVmOiAnV2Vic2l0ZUJ1Y2tldFBhcmFtT2xkJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIGNvbnN0IHBvbGljeTJOZXcgPSB7XG4gICAgICBUeXBlOiAnQVdTOjpJQU06OlBvbGljeScsXG4gICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgIFBvbGljeU5hbWU6ICdteS1wb2xpY3ktbmV3LTInLFxuICAgICAgICBSb2xlczogW1xuICAgICAgICAgIHsgUmVmOiAnU2VydmljZVJvbGUyJyB9LFxuICAgICAgICBdLFxuICAgICAgICBQb2xpY3lEb2N1bWVudDoge1xuICAgICAgICAgIFN0YXRlbWVudDogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBBY3Rpb246IFsnczM6R2V0T2JqZWN0KiddLFxuICAgICAgICAgICAgICBFZmZlY3Q6ICdBbGxvdycsXG4gICAgICAgICAgICAgIFJlc291cmNlOiB7XG4gICAgICAgICAgICAgICAgUmVmOiAnRGlmZmVyZW50QnVja2V0UGFyYW1PbGQnLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgY29uc3QgZGVwbG95bWVudExhbWJkYSA9IHtcbiAgICAgIFR5cGU6ICdBV1M6OkxhbWJkYTo6RnVuY3Rpb24nLFxuICAgICAgUm9sZToge1xuICAgICAgICAnRm46OkdldEF0dCc6IFtcbiAgICAgICAgICAnU2VydmljZVJvbGUnLFxuICAgICAgICAgICdBcm4nLFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgY29uc3QgczNEZXBsb3ltZW50T2xkID0ge1xuICAgICAgVHlwZTogJ0N1c3RvbTo6Q0RLQnVja2V0RGVwbG95bWVudCcsXG4gICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgIFNlcnZpY2VUb2tlbjoge1xuICAgICAgICAgICdGbjo6R2V0QXR0JzogW1xuICAgICAgICAgICAgJ1MzRGVwbG95bWVudExhbWJkYScsXG4gICAgICAgICAgICAnQXJuJyxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICBTb3VyY2VCdWNrZXROYW1lczogWydzcmMtYnVja2V0LW9sZCddLFxuICAgICAgICBTb3VyY2VPYmplY3RLZXlzOiBbJ3NyYy1rZXktb2xkJ10sXG4gICAgICAgIERlc3RpbmF0aW9uQnVja2V0TmFtZTogJ1dlYnNpdGVCdWNrZXRPbGQnLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgY29uc3QgczNEZXBsb3ltZW50TmV3ID0ge1xuICAgICAgVHlwZTogJ0N1c3RvbTo6Q0RLQnVja2V0RGVwbG95bWVudCcsXG4gICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgIFNlcnZpY2VUb2tlbjoge1xuICAgICAgICAgICdGbjo6R2V0QXR0JzogW1xuICAgICAgICAgICAgJ1MzRGVwbG95bWVudExhbWJkYScsXG4gICAgICAgICAgICAnQXJuJyxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICBTb3VyY2VCdWNrZXROYW1lczogWydzcmMtYnVja2V0LW5ldyddLFxuICAgICAgICBTb3VyY2VPYmplY3RLZXlzOiBbJ3NyYy1rZXktbmV3J10sXG4gICAgICAgIERlc3RpbmF0aW9uQnVja2V0TmFtZTogJ1dlYnNpdGVCdWNrZXROZXcnLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBzZXR1cC5wdXNoU3RhY2tSZXNvdXJjZVN1bW1hcmllcyhcbiAgICAgICAgc2V0dXAuc3RhY2tTdW1tYXJ5T2YoJ1MzRGVwbG95bWVudExhbWJkYScsICdBV1M6OkxhbWJkYTo6RnVuY3Rpb24nLCAnbXktZGVwbG95bWVudC1sYW1iZGEnKSxcbiAgICAgICAgc2V0dXAuc3RhY2tTdW1tYXJ5T2YoJ1NlcnZpY2VSb2xlJywgJ0FXUzo6SUFNOjpSb2xlJywgJ215LXNlcnZpY2Utcm9sZScpLFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2NhbGxzIHRoZSBsYW1iZGFJbnZva2UoKSBBUEkgd2hlbiBpdCByZWNlaXZlcyBhbiBhc3NldCBkaWZmZXJlbmNlIGluIGFuIFMzIGJ1Y2tldCBkZXBsb3ltZW50IGFuZCBhbiBJQU0gUG9saWN5IGRpZmZlcmVuY2UgdXNpbmcgb2xkLXN0eWxlIHN5bnRoZXNpcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEdJVkVOXG4gICAgICBzZXR1cC5zZXRDdXJyZW50Q2ZuU3RhY2tUZW1wbGF0ZSh7XG4gICAgICAgIFJlc291cmNlczoge1xuICAgICAgICAgIFBhcmFtZXRlcnM6IHBhcmFtZXRlcnMsXG4gICAgICAgICAgU2VydmljZVJvbGU6IHNlcnZpY2VSb2xlLFxuICAgICAgICAgIFBvbGljeTogcG9saWN5T2xkLFxuICAgICAgICAgIFMzRGVwbG95bWVudExhbWJkYTogZGVwbG95bWVudExhbWJkYSxcbiAgICAgICAgICBTM0RlcGxveW1lbnQ6IHMzRGVwbG95bWVudE9sZCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjZGtTdGFja0FydGlmYWN0ID0gc2V0dXAuY2RrU3RhY2tBcnRpZmFjdE9mKHtcbiAgICAgICAgdGVtcGxhdGU6IHtcbiAgICAgICAgICBSZXNvdXJjZXM6IHtcbiAgICAgICAgICAgIFBhcmFtZXRlcnM6IHBhcmFtZXRlcnMsXG4gICAgICAgICAgICBTZXJ2aWNlUm9sZTogc2VydmljZVJvbGUsXG4gICAgICAgICAgICBQb2xpY3k6IHBvbGljeU5ldyxcbiAgICAgICAgICAgIFMzRGVwbG95bWVudExhbWJkYTogZGVwbG95bWVudExhbWJkYSxcbiAgICAgICAgICAgIFMzRGVwbG95bWVudDogczNEZXBsb3ltZW50TmV3LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgLy8gV0hFTlxuICAgICAgY29uc3QgZGVwbG95U3RhY2tSZXN1bHQgPSBhd2FpdCBob3Rzd2FwTW9ja1Nka1Byb3ZpZGVyLnRyeUhvdHN3YXBEZXBsb3ltZW50KGhvdHN3YXBNb2RlLCBjZGtTdGFja0FydGlmYWN0LCB7IFdlYnNpdGVCdWNrZXRQYXJhbU9sZDogJ1dlYnNpdGVCdWNrZXRPbGQnLCBXZWJzaXRlQnVja2V0UGFyYW1OZXc6ICdXZWJzaXRlQnVja2V0TmV3JyB9KTtcblxuICAgICAgLy8gVEhFTlxuICAgICAgZXhwZWN0KGRlcGxveVN0YWNrUmVzdWx0KS5ub3QudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KG1vY2tMYW1iZGFJbnZva2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgRnVuY3Rpb25OYW1lOiAnYXJuOmF3czpsYW1iZGE6aGVyZToxMjM0NTY3ODkwMTI6ZnVuY3Rpb246bXktZGVwbG95bWVudC1sYW1iZGEnLFxuICAgICAgICBQYXlsb2FkOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgLi4ucGF5bG9hZFdpdGhvdXRDdXN0b21SZXNQcm9wcyxcbiAgICAgICAgICBSZXNvdXJjZVByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgIFNvdXJjZUJ1Y2tldE5hbWVzOiBbJ3NyYy1idWNrZXQtbmV3J10sXG4gICAgICAgICAgICBTb3VyY2VPYmplY3RLZXlzOiBbJ3NyYy1rZXktbmV3J10sXG4gICAgICAgICAgICBEZXN0aW5hdGlvbkJ1Y2tldE5hbWU6ICdXZWJzaXRlQnVja2V0TmV3JyxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgdGVzdChgZG9lcyBub3QgY2FsbCB0aGUgbGFtYmRhSW52b2tlKCkgQVBJIHdoZW4gdGhlIGRpZmZlcmVuY2UgaW4gdGhlIFMzIGRlcGxveW1lbnQgaXMgcmVmZXJyZWQgdG8gaW4gb25lIElBTSBwb2xpY3kgY2hhbmdlIGJ1dCBub3QgYW5vdGhlclxuICAgICAgICAgIGluIENMQVNTSUMgbW9kZSBidXQgZG9lcyBpbiBIT1RTV0FQX09OTFlgLFxuICAgIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEdJVkVOXG4gICAgICBzZXR1cC5zZXRDdXJyZW50Q2ZuU3RhY2tUZW1wbGF0ZSh7XG4gICAgICAgIFJlc291cmNlczoge1xuICAgICAgICAgIFNlcnZpY2VSb2xlOiBzZXJ2aWNlUm9sZSxcbiAgICAgICAgICBQb2xpY3kxOiBwb2xpY3lPbGQsXG4gICAgICAgICAgUG9saWN5MjogcG9saWN5Mk9sZCxcbiAgICAgICAgICBTM0RlcGxveW1lbnRMYW1iZGE6IGRlcGxveW1lbnRMYW1iZGEsXG4gICAgICAgICAgUzNEZXBsb3ltZW50OiBzM0RlcGxveW1lbnRPbGQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY2RrU3RhY2tBcnRpZmFjdCA9IHNldHVwLmNka1N0YWNrQXJ0aWZhY3RPZih7XG4gICAgICAgIHRlbXBsYXRlOiB7XG4gICAgICAgICAgUmVzb3VyY2VzOiB7XG4gICAgICAgICAgICBTZXJ2aWNlUm9sZTogc2VydmljZVJvbGUsXG4gICAgICAgICAgICBQb2xpY3kxOiBwb2xpY3lOZXcsXG4gICAgICAgICAgICBQb2xpY3kyOiB7XG4gICAgICAgICAgICAgIFByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgICBSb2xlczogW1xuICAgICAgICAgICAgICAgICAgeyBSZWY6ICdTZXJ2aWNlUm9sZScgfSxcbiAgICAgICAgICAgICAgICAgICdkaWZmZXJlbnQtcm9sZScsXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBQb2xpY3lEb2N1bWVudDoge1xuICAgICAgICAgICAgICAgICAgU3RhdGVtZW50OiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICBBY3Rpb246IFsnczM6R2V0T2JqZWN0KiddLFxuICAgICAgICAgICAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgICAgICAgICAgICBSZXNvdXJjZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ0ZuOjpHZXRBdHQnOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICdEaWZmZXJlbnRCdWNrZXROZXcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAnQXJuJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBTM0RlcGxveW1lbnRMYW1iZGE6IGRlcGxveW1lbnRMYW1iZGEsXG4gICAgICAgICAgICBTM0RlcGxveW1lbnQ6IHMzRGVwbG95bWVudE5ldyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChob3Rzd2FwTW9kZSA9PT0gSG90c3dhcE1vZGUuRkFMTF9CQUNLKSB7XG4gICAgICAgIC8vIFdIRU5cbiAgICAgICAgY29uc3QgZGVwbG95U3RhY2tSZXN1bHQgPSBhd2FpdCBob3Rzd2FwTW9ja1Nka1Byb3ZpZGVyLnRyeUhvdHN3YXBEZXBsb3ltZW50KGhvdHN3YXBNb2RlLCBjZGtTdGFja0FydGlmYWN0KTtcblxuICAgICAgICAvLyBUSEVOXG4gICAgICAgIGV4cGVjdChkZXBsb3lTdGFja1Jlc3VsdCkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QobW9ja0xhbWJkYUludm9rZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIH0gZWxzZSBpZiAoaG90c3dhcE1vZGUgPT09IEhvdHN3YXBNb2RlLkhPVFNXQVBfT05MWSkge1xuICAgICAgICAvLyBXSEVOXG4gICAgICAgIGNvbnN0IGRlcGxveVN0YWNrUmVzdWx0ID0gYXdhaXQgaG90c3dhcE1vY2tTZGtQcm92aWRlci50cnlIb3Rzd2FwRGVwbG95bWVudChob3Rzd2FwTW9kZSwgY2RrU3RhY2tBcnRpZmFjdCk7XG5cbiAgICAgICAgLy8gVEhFTlxuICAgICAgICBleHBlY3QoZGVwbG95U3RhY2tSZXN1bHQpLm5vdC50b0JlVW5kZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChtb2NrTGFtYmRhSW52b2tlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgRnVuY3Rpb25OYW1lOiAnYXJuOmF3czpsYW1iZGE6aGVyZToxMjM0NTY3ODkwMTI6ZnVuY3Rpb246bXktZGVwbG95bWVudC1sYW1iZGEnLFxuICAgICAgICAgIFBheWxvYWQ6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIC4uLnBheWxvYWRXaXRob3V0Q3VzdG9tUmVzUHJvcHMsXG4gICAgICAgICAgICBSZXNvdXJjZVByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgU291cmNlQnVja2V0TmFtZXM6IFsnc3JjLWJ1Y2tldC1uZXcnXSxcbiAgICAgICAgICAgICAgU291cmNlT2JqZWN0S2V5czogWydzcmMta2V5LW5ldyddLFxuICAgICAgICAgICAgICBEZXN0aW5hdGlvbkJ1Y2tldE5hbWU6ICdXZWJzaXRlQnVja2V0TmV3JyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGVzdChgZG9lcyBub3QgY2FsbCB0aGUgbGFtYmRhSW52b2tlKCkgQVBJIHdoZW4gdGhlIGxhbWJkYSB0aGF0IHJlZmVyZW5jZXMgdGhlIHJvbGUgaXMgcmVmZXJyZWQgdG8gYnkgc29tZXRoaW5nIG90aGVyIHRoYW4gYW4gUzMgZGVwbG95bWVudFxuICAgICAgICAgIGluIENMQVNTSUMgbW9kZSBidXQgZG9lcyBpbiBIT1RTV0FQX09OTFkgbW9kZWAsXG4gICAgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gR0lWRU5cbiAgICAgIHNldHVwLnNldEN1cnJlbnRDZm5TdGFja1RlbXBsYXRlKHtcbiAgICAgICAgUmVzb3VyY2VzOiB7XG4gICAgICAgICAgU2VydmljZVJvbGU6IHNlcnZpY2VSb2xlLFxuICAgICAgICAgIFBvbGljeTogcG9saWN5T2xkLFxuICAgICAgICAgIFMzRGVwbG95bWVudExhbWJkYTogZGVwbG95bWVudExhbWJkYSxcbiAgICAgICAgICBTM0RlcGxveW1lbnQ6IHMzRGVwbG95bWVudE9sZCxcbiAgICAgICAgICBFbmRwb2ludDoge1xuICAgICAgICAgICAgVHlwZTogJ0FXUzo6TGFtYmRhOjpQZXJtaXNzaW9uJyxcbiAgICAgICAgICAgIFByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgQWN0aW9uOiAnbGFtYmRhOkludm9rZUZ1bmN0aW9uJyxcbiAgICAgICAgICAgICAgRnVuY3Rpb25OYW1lOiB7XG4gICAgICAgICAgICAgICAgJ0ZuOjpHZXRBdHQnOiBbXG4gICAgICAgICAgICAgICAgICAnUzNEZXBsb3ltZW50TGFtYmRhJyxcbiAgICAgICAgICAgICAgICAgICdBcm4nLFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIFByaW5jaXBhbDogJ2FwaWdhdGV3YXkuYW1hem9uYXdzLmNvbScsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY2RrU3RhY2tBcnRpZmFjdCA9IHNldHVwLmNka1N0YWNrQXJ0aWZhY3RPZih7XG4gICAgICAgIHRlbXBsYXRlOiB7XG4gICAgICAgICAgUmVzb3VyY2VzOiB7XG4gICAgICAgICAgICBTZXJ2aWNlUm9sZTogc2VydmljZVJvbGUsXG4gICAgICAgICAgICBQb2xpY3k6IHBvbGljeU5ldyxcbiAgICAgICAgICAgIFMzRGVwbG95bWVudExhbWJkYTogZGVwbG95bWVudExhbWJkYSxcbiAgICAgICAgICAgIFMzRGVwbG95bWVudDogczNEZXBsb3ltZW50TmV3LFxuICAgICAgICAgICAgRW5kcG9pbnQ6IHtcbiAgICAgICAgICAgICAgVHlwZTogJ0FXUzo6TGFtYmRhOjpQZXJtaXNzaW9uJyxcbiAgICAgICAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgIEFjdGlvbjogJ2xhbWJkYTpJbnZva2VGdW5jdGlvbicsXG4gICAgICAgICAgICAgICAgRnVuY3Rpb25OYW1lOiB7XG4gICAgICAgICAgICAgICAgICAnRm46OkdldEF0dCc6IFtcbiAgICAgICAgICAgICAgICAgICAgJ1MzRGVwbG95bWVudExhbWJkYScsXG4gICAgICAgICAgICAgICAgICAgICdBcm4nLFxuICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFByaW5jaXBhbDogJ2FwaWdhdGV3YXkuYW1hem9uYXdzLmNvbScsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKGhvdHN3YXBNb2RlID09PSBIb3Rzd2FwTW9kZS5GQUxMX0JBQ0spIHtcbiAgICAgICAgLy8gV0hFTlxuICAgICAgICBjb25zdCBkZXBsb3lTdGFja1Jlc3VsdCA9IGF3YWl0IGhvdHN3YXBNb2NrU2RrUHJvdmlkZXIudHJ5SG90c3dhcERlcGxveW1lbnQoaG90c3dhcE1vZGUsIGNka1N0YWNrQXJ0aWZhY3QpO1xuXG4gICAgICAgIC8vIFRIRU5cbiAgICAgICAgZXhwZWN0KGRlcGxveVN0YWNrUmVzdWx0KS50b0JlVW5kZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChtb2NrTGFtYmRhSW52b2tlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgfSBlbHNlIGlmIChob3Rzd2FwTW9kZSA9PT0gSG90c3dhcE1vZGUuSE9UU1dBUF9PTkxZKSB7XG4gICAgICAgIC8vIFdIRU5cbiAgICAgICAgY29uc3QgZGVwbG95U3RhY2tSZXN1bHQgPSBhd2FpdCBob3Rzd2FwTW9ja1Nka1Byb3ZpZGVyLnRyeUhvdHN3YXBEZXBsb3ltZW50KGhvdHN3YXBNb2RlLCBjZGtTdGFja0FydGlmYWN0KTtcblxuICAgICAgICAvLyBUSEVOXG4gICAgICAgIGV4cGVjdChkZXBsb3lTdGFja1Jlc3VsdCkubm90LnRvQmVVbmRlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KG1vY2tMYW1iZGFJbnZva2UpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgICBGdW5jdGlvbk5hbWU6ICdhcm46YXdzOmxhbWJkYTpoZXJlOjEyMzQ1Njc4OTAxMjpmdW5jdGlvbjpteS1kZXBsb3ltZW50LWxhbWJkYScsXG4gICAgICAgICAgUGF5bG9hZDogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgLi4ucGF5bG9hZFdpdGhvdXRDdXN0b21SZXNQcm9wcyxcbiAgICAgICAgICAgIFJlc291cmNlUHJvcGVydGllczoge1xuICAgICAgICAgICAgICBTb3VyY2VCdWNrZXROYW1lczogWydzcmMtYnVja2V0LW5ldyddLFxuICAgICAgICAgICAgICBTb3VyY2VPYmplY3RLZXlzOiBbJ3NyYy1rZXktbmV3J10sXG4gICAgICAgICAgICAgIERlc3RpbmF0aW9uQnVja2V0TmFtZTogJ1dlYnNpdGVCdWNrZXROZXcnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdjYWxscyB0aGUgbGFtYmRhSW52b2tlKCkgQVBJIHdoZW4gaXQgcmVjZWl2ZXMgYW4gYXNzZXQgZGlmZmVyZW5jZSBpbiB0d28gUzMgYnVja2V0IGRlcGxveW1lbnRzIGFuZCBJQU0gUG9saWN5IGRpZmZlcmVuY2VzIHVzaW5nIG9sZC1zdHlsZSBzeW50aGVzaXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBHSVZFTlxuICAgICAgY29uc3QgczNEZXBsb3ltZW50Mk9sZCA9IHtcbiAgICAgICAgVHlwZTogJ0N1c3RvbTo6Q0RLQnVja2V0RGVwbG95bWVudCcsXG4gICAgICAgIFByb3BlcnRpZXM6IHtcbiAgICAgICAgICBTZXJ2aWNlVG9rZW46IHtcbiAgICAgICAgICAgICdGbjo6R2V0QXR0JzogW1xuICAgICAgICAgICAgICAnUzNEZXBsb3ltZW50TGFtYmRhMicsXG4gICAgICAgICAgICAgICdBcm4nLFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIFNvdXJjZUJ1Y2tldE5hbWVzOiBbJ3NyYy1idWNrZXQtb2xkJ10sXG4gICAgICAgICAgU291cmNlT2JqZWN0S2V5czogWydzcmMta2V5LW9sZCddLFxuICAgICAgICAgIERlc3RpbmF0aW9uQnVja2V0TmFtZTogJ0RpZmZlcmVudEJ1Y2tldE9sZCcsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBzM0RlcGxveW1lbnQyTmV3ID0ge1xuICAgICAgICBUeXBlOiAnQ3VzdG9tOjpDREtCdWNrZXREZXBsb3ltZW50JyxcbiAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgIFNlcnZpY2VUb2tlbjoge1xuICAgICAgICAgICAgJ0ZuOjpHZXRBdHQnOiBbXG4gICAgICAgICAgICAgICdTM0RlcGxveW1lbnRMYW1iZGEyJyxcbiAgICAgICAgICAgICAgJ0FybicsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgU291cmNlQnVja2V0TmFtZXM6IFsnc3JjLWJ1Y2tldC1uZXcnXSxcbiAgICAgICAgICBTb3VyY2VPYmplY3RLZXlzOiBbJ3NyYy1rZXktbmV3J10sXG4gICAgICAgICAgRGVzdGluYXRpb25CdWNrZXROYW1lOiAnRGlmZmVyZW50QnVja2V0TmV3JyxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIHNldHVwLnNldEN1cnJlbnRDZm5TdGFja1RlbXBsYXRlKHtcbiAgICAgICAgUmVzb3VyY2VzOiB7XG4gICAgICAgICAgU2VydmljZVJvbGU6IHNlcnZpY2VSb2xlLFxuICAgICAgICAgIFNlcnZpY2VSb2xlMjogc2VydmljZVJvbGUsXG4gICAgICAgICAgUG9saWN5MTogcG9saWN5T2xkLFxuICAgICAgICAgIFBvbGljeTI6IHBvbGljeTJPbGQsXG4gICAgICAgICAgUzNEZXBsb3ltZW50TGFtYmRhOiBkZXBsb3ltZW50TGFtYmRhLFxuICAgICAgICAgIFMzRGVwbG95bWVudExhbWJkYTI6IGRlcGxveW1lbnRMYW1iZGEsXG4gICAgICAgICAgUzNEZXBsb3ltZW50OiBzM0RlcGxveW1lbnRPbGQsXG4gICAgICAgICAgUzNEZXBsb3ltZW50MjogczNEZXBsb3ltZW50Mk9sZCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjZGtTdGFja0FydGlmYWN0ID0gc2V0dXAuY2RrU3RhY2tBcnRpZmFjdE9mKHtcbiAgICAgICAgdGVtcGxhdGU6IHtcbiAgICAgICAgICBSZXNvdXJjZXM6IHtcbiAgICAgICAgICAgIFBhcmFtZXRlcnM6IHBhcmFtZXRlcnMsXG4gICAgICAgICAgICBTZXJ2aWNlUm9sZTogc2VydmljZVJvbGUsXG4gICAgICAgICAgICBTZXJ2aWNlUm9sZTI6IHNlcnZpY2VSb2xlLFxuICAgICAgICAgICAgUG9saWN5MTogcG9saWN5TmV3LFxuICAgICAgICAgICAgUG9saWN5MjogcG9saWN5Mk5ldyxcbiAgICAgICAgICAgIFMzRGVwbG95bWVudExhbWJkYTogZGVwbG95bWVudExhbWJkYSxcbiAgICAgICAgICAgIFMzRGVwbG95bWVudExhbWJkYTI6IGRlcGxveW1lbnRMYW1iZGEsXG4gICAgICAgICAgICBTM0RlcGxveW1lbnQ6IHMzRGVwbG95bWVudE5ldyxcbiAgICAgICAgICAgIFMzRGVwbG95bWVudDI6IHMzRGVwbG95bWVudDJOZXcsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBXSEVOXG4gICAgICBzZXR1cC5wdXNoU3RhY2tSZXNvdXJjZVN1bW1hcmllcyhcbiAgICAgICAgc2V0dXAuc3RhY2tTdW1tYXJ5T2YoJ1MzRGVwbG95bWVudExhbWJkYTInLCAnQVdTOjpMYW1iZGE6OkZ1bmN0aW9uJywgJ215LWRlcGxveW1lbnQtbGFtYmRhLTInKSxcbiAgICAgICAgc2V0dXAuc3RhY2tTdW1tYXJ5T2YoJ1NlcnZpY2VSb2xlMicsICdBV1M6OklBTTo6Um9sZScsICdteS1zZXJ2aWNlLXJvbGUtMicpLFxuICAgICAgKTtcblxuICAgICAgY29uc3QgZGVwbG95U3RhY2tSZXN1bHQgPSBhd2FpdCBob3Rzd2FwTW9ja1Nka1Byb3ZpZGVyLnRyeUhvdHN3YXBEZXBsb3ltZW50KGhvdHN3YXBNb2RlLCBjZGtTdGFja0FydGlmYWN0LCB7XG4gICAgICAgIFdlYnNpdGVCdWNrZXRQYXJhbU9sZDogJ1dlYnNpdGVCdWNrZXRPbGQnLFxuICAgICAgICBXZWJzaXRlQnVja2V0UGFyYW1OZXc6ICdXZWJzaXRlQnVja2V0TmV3JyxcbiAgICAgICAgRGlmZmVyZW50QnVja2V0UGFyYW1OZXc6ICdXZWJzaXRlQnVja2V0TmV3JyxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBUSEVOXG4gICAgICBleHBlY3QoZGVwbG95U3RhY2tSZXN1bHQpLm5vdC50b0JlVW5kZWZpbmVkKCk7XG4gICAgICBleHBlY3QobW9ja0xhbWJkYUludm9rZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBGdW5jdGlvbk5hbWU6ICdhcm46YXdzOmxhbWJkYTpoZXJlOjEyMzQ1Njc4OTAxMjpmdW5jdGlvbjpteS1kZXBsb3ltZW50LWxhbWJkYScsXG4gICAgICAgIFBheWxvYWQ6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAuLi5wYXlsb2FkV2l0aG91dEN1c3RvbVJlc1Byb3BzLFxuICAgICAgICAgIFJlc291cmNlUHJvcGVydGllczoge1xuICAgICAgICAgICAgU291cmNlQnVja2V0TmFtZXM6IFsnc3JjLWJ1Y2tldC1uZXcnXSxcbiAgICAgICAgICAgIFNvdXJjZU9iamVjdEtleXM6IFsnc3JjLWtleS1uZXcnXSxcbiAgICAgICAgICAgIERlc3RpbmF0aW9uQnVja2V0TmFtZTogJ1dlYnNpdGVCdWNrZXROZXcnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChtb2NrTGFtYmRhSW52b2tlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIEZ1bmN0aW9uTmFtZTogJ2Fybjphd3M6bGFtYmRhOmhlcmU6MTIzNDU2Nzg5MDEyOmZ1bmN0aW9uOm15LWRlcGxveW1lbnQtbGFtYmRhLTInLFxuICAgICAgICBQYXlsb2FkOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgLi4ucGF5bG9hZFdpdGhvdXRDdXN0b21SZXNQcm9wcyxcbiAgICAgICAgICBSZXNvdXJjZVByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgIFNvdXJjZUJ1Y2tldE5hbWVzOiBbJ3NyYy1idWNrZXQtbmV3J10sXG4gICAgICAgICAgICBTb3VyY2VPYmplY3RLZXlzOiBbJ3NyYy1rZXktbmV3J10sXG4gICAgICAgICAgICBEZXN0aW5hdGlvbkJ1Y2tldE5hbWU6ICdEaWZmZXJlbnRCdWNrZXROZXcnLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KGBkb2VzIG5vdCBjYWxsIHRoZSBsYW1iZGFJbnZva2UoKSBBUEkgd2hlbiBpdCByZWNlaXZlcyBhbiBhc3NldCBkaWZmZXJlbmNlIGluIGFuIFMzIGJ1Y2tldCBkZXBsb3ltZW50IHRoYXQgcmVmZXJlbmNlcyB0d28gZGlmZmVyZW50IHBvbGljaWVzXG4gICAgICAgICAgaW4gQ0xBU1NJQyBtb2RlIGJ1dCBkb2VzIGluIEhPVFNXQVBfT05MWSBtb2RlYCxcbiAgICBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBHSVZFTlxuICAgICAgc2V0dXAuc2V0Q3VycmVudENmblN0YWNrVGVtcGxhdGUoe1xuICAgICAgICBSZXNvdXJjZXM6IHtcbiAgICAgICAgICBTZXJ2aWNlUm9sZTogc2VydmljZVJvbGUsXG4gICAgICAgICAgUG9saWN5MTogcG9saWN5T2xkLFxuICAgICAgICAgIFBvbGljeTI6IHBvbGljeTJPbGQsXG4gICAgICAgICAgUzNEZXBsb3ltZW50TGFtYmRhOiBkZXBsb3ltZW50TGFtYmRhLFxuICAgICAgICAgIFMzRGVwbG95bWVudDogczNEZXBsb3ltZW50T2xkLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGNka1N0YWNrQXJ0aWZhY3QgPSBzZXR1cC5jZGtTdGFja0FydGlmYWN0T2Yoe1xuICAgICAgICB0ZW1wbGF0ZToge1xuICAgICAgICAgIFJlc291cmNlczoge1xuICAgICAgICAgICAgU2VydmljZVJvbGU6IHNlcnZpY2VSb2xlLFxuICAgICAgICAgICAgUG9saWN5MTogcG9saWN5TmV3LFxuICAgICAgICAgICAgUG9saWN5Mjoge1xuICAgICAgICAgICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgICAgUm9sZXM6IFtcbiAgICAgICAgICAgICAgICAgIHsgUmVmOiAnU2VydmljZVJvbGUnIH0sXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBQb2xpY3lEb2N1bWVudDoge1xuICAgICAgICAgICAgICAgICAgU3RhdGVtZW50OiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICBBY3Rpb246IFsnczM6R2V0T2JqZWN0KiddLFxuICAgICAgICAgICAgICAgICAgICAgIEVmZmVjdDogJ0FsbG93JyxcbiAgICAgICAgICAgICAgICAgICAgICBSZXNvdXJjZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ0ZuOjpHZXRBdHQnOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICdEaWZmZXJlbnRCdWNrZXROZXcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAnQXJuJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBTM0RlcGxveW1lbnRMYW1iZGE6IGRlcGxveW1lbnRMYW1iZGEsXG4gICAgICAgICAgICBTM0RlcGxveW1lbnQ6IHMzRGVwbG95bWVudE5ldyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChob3Rzd2FwTW9kZSA9PT0gSG90c3dhcE1vZGUuRkFMTF9CQUNLKSB7XG4gICAgICAgIC8vIFdIRU5cbiAgICAgICAgY29uc3QgZGVwbG95U3RhY2tSZXN1bHQgPSBhd2FpdCBob3Rzd2FwTW9ja1Nka1Byb3ZpZGVyLnRyeUhvdHN3YXBEZXBsb3ltZW50KGhvdHN3YXBNb2RlLCBjZGtTdGFja0FydGlmYWN0KTtcblxuICAgICAgICAvLyBUSEVOXG4gICAgICAgIGV4cGVjdChkZXBsb3lTdGFja1Jlc3VsdCkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QobW9ja0xhbWJkYUludm9rZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIH0gZWxzZSBpZiAoaG90c3dhcE1vZGUgPT09IEhvdHN3YXBNb2RlLkhPVFNXQVBfT05MWSkge1xuICAgICAgICAvLyBXSEVOXG4gICAgICAgIGNvbnN0IGRlcGxveVN0YWNrUmVzdWx0ID0gYXdhaXQgaG90c3dhcE1vY2tTZGtQcm92aWRlci50cnlIb3Rzd2FwRGVwbG95bWVudChob3Rzd2FwTW9kZSwgY2RrU3RhY2tBcnRpZmFjdCk7XG5cbiAgICAgICAgLy8gVEhFTlxuICAgICAgICBleHBlY3QoZGVwbG95U3RhY2tSZXN1bHQpLm5vdC50b0JlVW5kZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChtb2NrTGFtYmRhSW52b2tlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgRnVuY3Rpb25OYW1lOiAnYXJuOmF3czpsYW1iZGE6aGVyZToxMjM0NTY3ODkwMTI6ZnVuY3Rpb246bXktZGVwbG95bWVudC1sYW1iZGEnLFxuICAgICAgICAgIFBheWxvYWQ6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIC4uLnBheWxvYWRXaXRob3V0Q3VzdG9tUmVzUHJvcHMsXG4gICAgICAgICAgICBSZXNvdXJjZVByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgU291cmNlQnVja2V0TmFtZXM6IFsnc3JjLWJ1Y2tldC1uZXcnXSxcbiAgICAgICAgICAgICAgU291cmNlT2JqZWN0S2V5czogWydzcmMta2V5LW5ldyddLFxuICAgICAgICAgICAgICBEZXN0aW5hdGlvbkJ1Y2tldE5hbWU6ICdXZWJzaXRlQnVja2V0TmV3JyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGVzdChgZG9lcyBub3QgY2FsbCB0aGUgbGFtYmRhSW52b2tlKCkgQVBJIHdoZW4gYSBwb2xpY3kgaXMgcmVmZXJlbmNlZCBieSBhIHJlc291cmNlIHRoYXQgaXMgbm90IGFuIFMzIGRlcGxveW1lbnRcbiAgICAgICAgICBpbiBDTEFTU0lDIG1vZGUgYnV0IGRvZXMgaW4gSE9UU1dBUF9PTkxZIG1vZGVgLFxuICAgIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEdJVkVOXG4gICAgICBzZXR1cC5zZXRDdXJyZW50Q2ZuU3RhY2tUZW1wbGF0ZSh7XG4gICAgICAgIFJlc291cmNlczoge1xuICAgICAgICAgIFNlcnZpY2VSb2xlOiBzZXJ2aWNlUm9sZSxcbiAgICAgICAgICBQb2xpY3kxOiBwb2xpY3lPbGQsXG4gICAgICAgICAgUzNEZXBsb3ltZW50TGFtYmRhOiBkZXBsb3ltZW50TGFtYmRhLFxuICAgICAgICAgIFMzRGVwbG95bWVudDogczNEZXBsb3ltZW50T2xkLFxuICAgICAgICAgIE5vdEFEZXBsb3ltZW50OiB7XG4gICAgICAgICAgICBUeXBlOiAnQVdTOjpOb3Q6OlMzRGVwbG95bWVudCcsXG4gICAgICAgICAgICBQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgIFByb3A6IHtcbiAgICAgICAgICAgICAgICBSZWY6ICdTZXJ2aWNlUm9sZScsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY2RrU3RhY2tBcnRpZmFjdCA9IHNldHVwLmNka1N0YWNrQXJ0aWZhY3RPZih7XG4gICAgICAgIHRlbXBsYXRlOiB7XG4gICAgICAgICAgUmVzb3VyY2VzOiB7XG4gICAgICAgICAgICBTZXJ2aWNlUm9sZTogc2VydmljZVJvbGUsXG4gICAgICAgICAgICBQb2xpY3kxOiBwb2xpY3lOZXcsXG4gICAgICAgICAgICBTM0RlcGxveW1lbnRMYW1iZGE6IGRlcGxveW1lbnRMYW1iZGEsXG4gICAgICAgICAgICBTM0RlcGxveW1lbnQ6IHMzRGVwbG95bWVudE5ldyxcbiAgICAgICAgICAgIE5vdEFEZXBsb3ltZW50OiB7XG4gICAgICAgICAgICAgIFR5cGU6ICdBV1M6Ok5vdDo6UzNEZXBsb3ltZW50JyxcbiAgICAgICAgICAgICAgUHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgIFByb3A6IHtcbiAgICAgICAgICAgICAgICAgIFJlZjogJ1NlcnZpY2VSb2xlJyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChob3Rzd2FwTW9kZSA9PT0gSG90c3dhcE1vZGUuRkFMTF9CQUNLKSB7XG4gICAgICAgIC8vIFdIRU5cbiAgICAgICAgY29uc3QgZGVwbG95U3RhY2tSZXN1bHQgPSBhd2FpdCBob3Rzd2FwTW9ja1Nka1Byb3ZpZGVyLnRyeUhvdHN3YXBEZXBsb3ltZW50KGhvdHN3YXBNb2RlLCBjZGtTdGFja0FydGlmYWN0KTtcblxuICAgICAgICAvLyBUSEVOXG4gICAgICAgIGV4cGVjdChkZXBsb3lTdGFja1Jlc3VsdCkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgICBleHBlY3QobW9ja0xhbWJkYUludm9rZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIH0gZWxzZSBpZiAoaG90c3dhcE1vZGUgPT09IEhvdHN3YXBNb2RlLkhPVFNXQVBfT05MWSkge1xuICAgICAgICAvLyBXSEVOXG4gICAgICAgIGNvbnN0IGRlcGxveVN0YWNrUmVzdWx0ID0gYXdhaXQgaG90c3dhcE1vY2tTZGtQcm92aWRlci50cnlIb3Rzd2FwRGVwbG95bWVudChob3Rzd2FwTW9kZSwgY2RrU3RhY2tBcnRpZmFjdCk7XG5cbiAgICAgICAgLy8gVEhFTlxuICAgICAgICBleHBlY3QoZGVwbG95U3RhY2tSZXN1bHQpLm5vdC50b0JlVW5kZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChtb2NrTGFtYmRhSW52b2tlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgICAgRnVuY3Rpb25OYW1lOiAnYXJuOmF3czpsYW1iZGE6aGVyZToxMjM0NTY3ODkwMTI6ZnVuY3Rpb246bXktZGVwbG95bWVudC1sYW1iZGEnLFxuICAgICAgICAgIFBheWxvYWQ6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIC4uLnBheWxvYWRXaXRob3V0Q3VzdG9tUmVzUHJvcHMsXG4gICAgICAgICAgICBSZXNvdXJjZVByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgU291cmNlQnVja2V0TmFtZXM6IFsnc3JjLWJ1Y2tldC1uZXcnXSxcbiAgICAgICAgICAgICAgU291cmNlT2JqZWN0S2V5czogWydzcmMta2V5LW5ldyddLFxuICAgICAgICAgICAgICBEZXN0aW5hdGlvbkJ1Y2tldE5hbWU6ICdXZWJzaXRlQnVja2V0TmV3JyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSksXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19